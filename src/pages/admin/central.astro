---
import Layout from '../../layouts/Layout.astro';
---
<Layout title="Central de Controle | GetNexo Admin">

<div class="admin-central">
  
  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="logo">
        <span class="logo-icon">N</span>
        <span class="logo-text">Get<span class="accent">Nexo</span></span>
      </div>
      <button class="toggle-btn" id="toggle-sidebar">â˜°</button>
    </div>

    <div class="search-box">
      <input type="text" id="global-search" placeholder="Buscar... (Ctrl+K)" />
    </div>

    <nav class="sidebar-nav">
      
      <!-- Dashboard -->
      <div class="nav-section">
        <a href="/admin" class="nav-item active">
          <span class="nav-icon">ğŸ“Š</span>
          <span class="nav-text">Dashboard</span>
        </a>
      </div>

      <!-- E-commerce -->
      <div class="nav-section">
        <button class="nav-group-btn" data-target="ecommerce-menu">
          <span class="nav-icon">ğŸ›ï¸</span>
          <span class="nav-text">E-commerce</span>
          <span class="nav-arrow">â–¾</span>
        </button>
        <div class="nav-submenu" id="ecommerce-menu">
          <a href="#produtos" class="nav-subitem" data-section="produtos">Produtos</a>
          <a href="#pedidos" class="nav-subitem" data-section="pedidos">Pedidos</a>
          <a href="#cupons" class="nav-subitem" data-section="cupons">Cupons</a>
          <a href="#categorias" class="nav-subitem" data-section="categorias">Categorias</a>
          <a href="#estoque" class="nav-subitem" data-section="estoque">Estoque</a>
        </div>
      </div>

      <!-- Atendimento -->
      <div class="nav-section">
        <button class="nav-group-btn" data-target="atendimento-menu">
          <span class="nav-icon">ğŸ’¬</span>
          <span class="nav-text">Atendimento</span>
          <span class="nav-arrow">â–¾</span>
        </button>
        <div class="nav-submenu" id="atendimento-menu">
          <a href="#campanhas" class="nav-subitem" data-section="campanhas">Campanhas</a>
          <a href="#macros" class="nav-subitem" data-section="macros">Macros</a>
          <a href="#bot-config" class="nav-subitem" data-section="bot-config">Config do Bot</a>
          <a href="#horarios" class="nav-subitem" data-section="horarios">HorÃ¡rios</a>
          <a href="#filas" class="nav-subitem" data-section="filas">Filas de Atendimento</a>
        </div>
      </div>

      <!-- IA -->
      <div class="nav-section">
        <button class="nav-group-btn" data-target="ia-menu">
          <span class="nav-icon">ğŸ¤–</span>
          <span class="nav-text">InteligÃªncia Artificial</span>
          <span class="nav-arrow">â–¾</span>
        </button>
        <div class="nav-submenu" id="ia-menu">
          <a href="#ia-provedores" class="nav-subitem" data-section="ia-provedores">Provedores</a>
          <a href="#ia-prompts" class="nav-subitem" data-section="ia-prompts">Prompts</a>
          <a href="#ia-playground" class="nav-subitem" data-section="ia-playground">Playground</a>
          <a href="#ia-historico" class="nav-subitem" data-section="ia-historico">HistÃ³rico</a>
        </div>
      </div>

      <!-- IntegraÃ§Ãµes -->
      <div class="nav-section">
        <button class="nav-group-btn" data-target="integracoes-menu">
          <span class="nav-icon">ğŸ”—</span>
          <span class="nav-text">IntegraÃ§Ãµes</span>
          <span class="nav-arrow">â–¾</span>
        </button>
        <div class="nav-submenu" id="integracoes-menu">
          <a href="#int-whatsapp" class="nav-subitem" data-section="int-whatsapp">WhatsApp</a>
          <a href="#int-crm" class="nav-subitem" data-section="int-crm">CRMs</a>
          <a href="#int-pagamentos" class="nav-subitem" data-section="int-pagamentos">Pagamentos</a>
          <a href="#int-ecommerce" class="nav-subitem" data-section="int-ecommerce">E-commerce</a>
          <a href="#int-automacao" class="nav-subitem" data-section="int-automacao">AutomaÃ§Ã£o</a>
          <a href="#int-webhooks" class="nav-subitem" data-section="int-webhooks">Webhooks</a>
        </div>
      </div>

      <!-- RelatÃ³rios -->
      <div class="nav-section">
        <button class="nav-group-btn" data-target="relatorios-menu">
          <span class="nav-icon">ğŸ“ˆ</span>
          <span class="nav-text">RelatÃ³rios</span>
          <span class="nav-arrow">â–¾</span>
        </button>
        <div class="nav-submenu" id="relatorios-menu">
          <a href="#rel-vendas" class="nav-subitem" data-section="rel-vendas">Vendas</a>
          <a href="#rel-leads" class="nav-subitem" data-section="rel-leads">Leads</a>
          <a href="#rel-atendimento" class="nav-subitem" data-section="rel-atendimento">Atendimento</a>
          <a href="#rel-performance" class="nav-subitem" data-section="rel-performance">Performance</a>
          <a href="#rel-exportar" class="nav-subitem" data-section="rel-exportar">Exportar</a>
        </div>
      </div>

      <!-- SeguranÃ§a -->
      <div class="nav-section">
        <button class="nav-group-btn" data-target="seguranca-menu">
          <span class="nav-icon">ğŸ›¡ï¸</span>
          <span class="nav-text">SeguranÃ§a</span>
          <span class="nav-arrow">â–¾</span>
        </button>
        <div class="nav-submenu" id="seguranca-menu">
          <a href="/admin/usuarios" class="nav-subitem">UsuÃ¡rios</a>
          <a href="/admin/roles" class="nav-subitem">Roles</a>
          <a href="/admin/auditoria" class="nav-subitem">Auditoria</a>
          <a href="#seg-sessoes" class="nav-subitem" data-section="seg-sessoes">SessÃµes</a>
          <a href="#seg-ips" class="nav-subitem" data-section="seg-ips">Bloqueio de IPs</a>
        </div>
      </div>

      <!-- ConfiguraÃ§Ãµes -->
      <div class="nav-section">
        <button class="nav-group-btn" data-target="config-menu">
          <span class="nav-icon">âš™ï¸</span>
          <span class="nav-text">ConfiguraÃ§Ãµes</span>
          <span class="nav-arrow">â–¾</span>
        </button>
        <div class="nav-submenu" id="config-menu">
          <a href="#cfg-empresa" class="nav-subitem" data-section="cfg-empresa">Empresa</a>
          <a href="#cfg-email" class="nav-subitem" data-section="cfg-email">Email/SMTP</a>
          <a href="#cfg-notificacoes" class="nav-subitem" data-section="cfg-notificacoes">NotificaÃ§Ãµes</a>
          <a href="#cfg-api" class="nav-subitem" data-section="cfg-api">API/Tokens</a>
          <a href="#cfg-backup" class="nav-subitem" data-section="cfg-backup">Backup</a>
        </div>
      </div>

    </nav>

    <div class="sidebar-footer">
      <a href="/" target="_blank" class="nav-item">
        <span class="nav-icon">â†—</span>
        <span class="nav-text">Ver Site</span>
      </a>
      <button class="nav-item logout" onclick="logout()">
        <span class="nav-icon">ğŸšª</span>
        <span class="nav-text">Sair</span>
      </button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    
    <!-- Header -->
    <header class="content-header">
      <div class="header-left">
        <h1 id="section-title">Dashboard</h1>
        <span class="breadcrumb" id="breadcrumb">Central de Controle</span>
      </div>
      <div class="header-right">
        <span class="status-badge online">Sistema Online</span>
        <span class="time" id="clock">00:00</span>
        <div class="user-avatar" id="user-avatar">A</div>
      </div>
    </header>

    <!-- Dynamic Content Area -->
    <div class="content-area" id="content-area">
      
      <!-- Dashboard Section (Default) -->
      <section class="section-panel" id="section-dashboard" style="display:block;">
        <div class="stats-grid">
          <div class="stat-card">
            <span class="stat-icon">ğŸ’°</span>
            <div class="stat-info">
              <span class="stat-value" id="stat-vendas">R$ 0</span>
              <span class="stat-label">Vendas Hoje</span>
            </div>
          </div>
          <div class="stat-card">
            <span class="stat-icon">ğŸ“¦</span>
            <div class="stat-info">
              <span class="stat-value" id="stat-pedidos">0</span>
              <span class="stat-label">Pedidos</span>
            </div>
          </div>
          <div class="stat-card">
            <span class="stat-icon">ğŸ’¬</span>
            <div class="stat-info">
              <span class="stat-value" id="stat-conversas">0</span>
              <span class="stat-label">Conversas</span>
            </div>
          </div>
          <div class="stat-card">
            <span class="stat-icon">ğŸ‘¥</span>
            <div class="stat-info">
              <span class="stat-value" id="stat-leads">0</span>
              <span class="stat-label">Leads</span>
            </div>
          </div>
        </div>

        <div class="quick-actions">
          <h3>âš¡ AÃ§Ãµes RÃ¡pidas</h3>
          <div class="actions-grid">
            <button class="action-btn" onclick="showSection('produtos')">ğŸ›ï¸ Novo Produto</button>
            <button class="action-btn" onclick="showSection('cupons')">ğŸŸï¸ Criar Cupom</button>
            <button class="action-btn" onclick="showSection('campanhas')">ğŸ“¢ Nova Campanha</button>
            <button class="action-btn" onclick="showSection('ia-prompts')">ğŸ¤– Config IA</button>
          </div>
        </div>

        <div class="modules-overview">
          <h3>ğŸ“¦ MÃ³dulos do Sistema</h3>
          <div class="modules-grid" id="modules-grid">
            <!-- Modules will be loaded here -->
          </div>
        </div>
      </section>

      <!-- Produtos Section -->
      <section class="section-panel" id="section-produtos">
        <div class="section-header">
          <h2>ğŸ›ï¸ Gerenciar Produtos</h2>
          <button class="btn-primary" onclick="openModal('produto')">+ Novo Produto</button>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr><th>Produto</th><th>PreÃ§o</th><th>Estoque</th><th>Status</th><th>AÃ§Ãµes</th></tr>
            </thead>
            <tbody id="produtos-tbody">
              <tr><td colspan="5" class="loading">Carregando produtos...</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Cupons Section -->
      <section class="section-panel" id="section-cupons">
        <div class="section-header">
          <h2>ğŸŸï¸ Cupons de Desconto</h2>
          <button class="btn-primary" onclick="openModal('cupom')">+ Novo Cupom</button>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr><th>CÃ³digo</th><th>Desconto</th><th>Validade</th><th>Usos</th><th>Status</th><th>AÃ§Ãµes</th></tr>
            </thead>
            <tbody id="cupons-tbody">
              <tr><td colspan="6" class="loading">Carregando cupons...</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Campanhas Section -->
      <section class="section-panel" id="section-campanhas">
        <div class="section-header">
          <h2>ğŸ“¢ Campanhas de Broadcast</h2>
          <button class="btn-primary" onclick="openModal('campanha')">+ Nova Campanha</button>
        </div>
        <div class="campaigns-grid" id="campaigns-grid">
          <div class="loading">Carregando campanhas...</div>
        </div>
      </section>

      <!-- IA Provedores Section -->
      <section class="section-panel" id="section-ia-provedores">
        <div class="section-header">
          <h2>ğŸ¤– Provedores de IA</h2>
        </div>
        <div class="providers-grid" id="providers-grid">
          <!-- Providers will be loaded here -->
        </div>
      </section>

      <!-- IntegraÃ§Ãµes WhatsApp Section -->
      <section class="section-panel" id="section-int-whatsapp">
        <div class="section-header">
          <h2>ğŸ“± IntegraÃ§Ã£o WhatsApp</h2>
        </div>
        <div class="integration-card">
          <div class="integration-header">
            <span class="integration-icon" style="background:#25D366;">W</span>
            <div>
              <h3>Evolution API</h3>
              <span class="integration-status" id="whatsapp-status">Verificando...</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="whatsapp-toggle" checked />
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="integration-config">
            <div class="form-group">
              <label>URL da API</label>
              <input type="text" id="evolution-url" value="https://api.getnexo.com.br" />
            </div>
            <div class="form-group">
              <label>API Key</label>
              <input type="password" id="evolution-key" placeholder="Sua API Key" />
            </div>
            <div class="form-group">
              <label>Nome da InstÃ¢ncia</label>
              <input type="text" id="evolution-instance" value="getnexo" />
            </div>
            <button class="btn-primary" onclick="saveIntegration('whatsapp')">Salvar ConfiguraÃ§Ã£o</button>
          </div>
        </div>
      </section>

      <!-- IntegraÃ§Ãµes CRM Section -->
      <section class="section-panel" id="section-int-crm">
        <div class="section-header">
          <h2>ğŸ¢ IntegraÃ§Ãµes CRM</h2>
        </div>
        <div class="integrations-list" id="crm-integrations">
          <!-- CRM integrations will be loaded -->
        </div>
      </section>

      <!-- IntegraÃ§Ãµes Pagamentos Section -->
      <section class="section-panel" id="section-int-pagamentos">
        <div class="section-header">
          <h2>ğŸ’³ IntegraÃ§Ãµes de Pagamento</h2>
        </div>
        <div class="integrations-list" id="payment-integrations">
          <!-- Payment integrations will be loaded -->
        </div>
      </section>

      <!-- Config Empresa Section -->
      <section class="section-panel" id="section-cfg-empresa">
        <div class="section-header">
          <h2>ğŸ›ï¸ Dados da Empresa</h2>
        </div>
        <form id="company-form" class="config-form">
          <div class="form-row">
            <div class="form-group">
              <label>Nome da Empresa</label>
              <input type="text" id="company-name" placeholder="GetNexo" />
            </div>
            <div class="form-group">
              <label>CNPJ</label>
              <input type="text" id="company-cnpj" placeholder="00.000.000/0001-00" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Email de Contato</label>
              <input type="email" id="company-email" placeholder="contato@empresa.com" />
            </div>
            <div class="form-group">
              <label>Telefone</label>
              <input type="tel" id="company-phone" placeholder="(11) 99999-9999" />
            </div>
          </div>
          <div class="form-group">
            <label>EndereÃ§o</label>
            <input type="text" id="company-address" placeholder="Rua, nÃºmero, cidade - estado" />
          </div>
          <button type="submit" class="btn-primary">Salvar AlteraÃ§Ãµes</button>
        </form>
      </section>

      <!-- Macros Section -->
      <section class="section-panel" id="section-macros">
        <div class="section-header">
          <h2>âš¡ Macros / Respostas RÃ¡pidas</h2>
          <button class="btn-primary" onclick="openModal('macro')">+ Nova Macro</button>
        </div>
        <p style="color:#94a3b8; margin-bottom:1.5rem;">Crie respostas prontas para acelerar o atendimento</p>
        <div class="table-container">
          <table>
            <thead>
              <tr><th>Atalho</th><th>TÃ­tulo</th><th>ConteÃºdo</th><th>Status</th><th>AÃ§Ãµes</th></tr>
            </thead>
            <tbody id="macros-tbody">
              <tr><td colspan="5" class="loading">Carregando macros...</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- HorÃ¡rios Section -->
      <section class="section-panel" id="section-horarios">
        <div class="section-header">
          <h2>ğŸ• HorÃ¡rios de Atendimento</h2>
        </div>
        <div class="config-form">
          <div class="schedule-grid">
            <div class="schedule-day">
              <span class="day-name">Segunda</span>
              <label class="toggle-switch"><input type="checkbox" checked data-day="seg" /><span class="toggle-slider"></span></label>
              <input type="time" value="09:00" class="time-input" data-day="seg" data-type="start" />
              <span style="color:#64748b;">Ã s</span>
              <input type="time" value="18:00" class="time-input" data-day="seg" data-type="end" />
            </div>
            <div class="schedule-day">
              <span class="day-name">TerÃ§a</span>
              <label class="toggle-switch"><input type="checkbox" checked data-day="ter" /><span class="toggle-slider"></span></label>
              <input type="time" value="09:00" class="time-input" />
              <span style="color:#64748b;">Ã s</span>
              <input type="time" value="18:00" class="time-input" />
            </div>
            <div class="schedule-day">
              <span class="day-name">Quarta</span>
              <label class="toggle-switch"><input type="checkbox" checked data-day="qua" /><span class="toggle-slider"></span></label>
              <input type="time" value="09:00" class="time-input" />
              <span style="color:#64748b;">Ã s</span>
              <input type="time" value="18:00" class="time-input" />
            </div>
            <div class="schedule-day">
              <span class="day-name">Quinta</span>
              <label class="toggle-switch"><input type="checkbox" checked data-day="qui" /><span class="toggle-slider"></span></label>
              <input type="time" value="09:00" class="time-input" />
              <span style="color:#64748b;">Ã s</span>
              <input type="time" value="18:00" class="time-input" />
            </div>
            <div class="schedule-day">
              <span class="day-name">Sexta</span>
              <label class="toggle-switch"><input type="checkbox" checked data-day="sex" /><span class="toggle-slider"></span></label>
              <input type="time" value="09:00" class="time-input" />
              <span style="color:#64748b;">Ã s</span>
              <input type="time" value="18:00" class="time-input" />
            </div>
            <div class="schedule-day">
              <span class="day-name">SÃ¡bado</span>
              <label class="toggle-switch"><input type="checkbox" data-day="sab" /><span class="toggle-slider"></span></label>
              <input type="time" value="09:00" class="time-input" />
              <span style="color:#64748b;">Ã s</span>
              <input type="time" value="12:00" class="time-input" />
            </div>
            <div class="schedule-day">
              <span class="day-name">Domingo</span>
              <label class="toggle-switch"><input type="checkbox" data-day="dom" /><span class="toggle-slider"></span></label>
              <input type="time" value="09:00" class="time-input" disabled />
              <span style="color:#64748b;">Ã s</span>
              <input type="time" value="12:00" class="time-input" disabled />
            </div>
          </div>
          <div class="form-group" style="margin-top:1.5rem;">
            <label>Mensagem fora do horÃ¡rio</label>
            <textarea id="offline-message" rows="3" style="width:100%; padding:1rem; background:rgba(0,0,0,0.3); border:1px solid #334155; border-radius:10px; color:white;">OlÃ¡! ğŸ‘‹ Nosso atendimento funciona de segunda a sexta, das 09h Ã s 18h. Deixe sua mensagem que retornaremos em breve!</textarea>
          </div>
          <button class="btn-primary" onclick="saveSchedule()">Salvar HorÃ¡rios</button>
        </div>
      </section>

      <!-- IA Prompts Section -->
      <section class="section-panel" id="section-ia-prompts">
        <div class="section-header">
          <h2>ğŸ“ Prompts e Contexto da IA</h2>
        </div>
        <div class="config-form">
          <div class="form-group">
            <label>Nome do Assistente</label>
            <input type="text" id="ai-name" value="Nexo" placeholder="Nome do assistente" />
          </div>
          <div class="form-group">
            <label>Personalidade / Tom de Voz</label>
            <select id="ai-personality" style="width:100%; padding:0.75rem; background:rgba(0,0,0,0.3); border:1px solid #334155; border-radius:10px; color:white;">
              <option value="friendly">ğŸ˜Š AmigÃ¡vel e Informal</option>
              <option value="professional">ğŸ‘” Profissional e Formal</option>
              <option value="playful">ğŸ‰ Divertido e DescontraÃ­do</option>
              <option value="direct">âš¡ Direto e Objetivo</option>
            </select>
          </div>
          <div class="form-group">
            <label>Contexto do NegÃ³cio (System Prompt)</label>
            <textarea id="ai-context" rows="6" style="width:100%; padding:1rem; background:rgba(0,0,0,0.3); border:1px solid #334155; border-radius:10px; color:white; font-family:monospace;">VocÃª Ã© um assistente de vendas do GetNexo, uma plataforma de automaÃ§Ã£o para WhatsApp Business. Seu objetivo Ã© ajudar clientes com dÃºvidas sobre produtos, preÃ§os e funcionalidades.</textarea>
          </div>
          <div class="form-group">
            <label>InformaÃ§Ãµes da Empresa (para a IA conhecer)</label>
            <textarea id="ai-company-info" rows="4" style="width:100%; padding:1rem; background:rgba(0,0,0,0.3); border:1px solid #334155; border-radius:10px; color:white;">- GetNexo: Plataforma de automaÃ§Ã£o WhatsApp
- Planos: Starter (R$97/mÃªs), Pro (R$197/mÃªs), Enterprise (R$497/mÃªs)
- Suporte: Segunda a Sexta, 9h Ã s 18h</textarea>
          </div>
          <button class="btn-primary" onclick="saveAIPrompts()">Salvar ConfiguraÃ§Ãµes de IA</button>
        </div>
      </section>

      <!-- IA Playground Section -->
      <section class="section-panel" id="section-ia-playground">
        <div class="section-header">
          <h2>ğŸ§ª Playground de IA</h2>
        </div>
        <div class="playground-container">
          <div class="playground-chat" id="playground-chat">
            <div class="chat-message bot">
              <span class="avatar">ğŸ¤–</span>
              <div class="message-content">OlÃ¡! Sou o assistente do GetNexo. Teste aqui suas configuraÃ§Ãµes de IA.</div>
            </div>
          </div>
          <div class="playground-input">
            <input type="text" id="playground-input" placeholder="Digite uma mensagem para testar..." />
            <button class="btn-primary" onclick="testAI()">Enviar</button>
          </div>
        </div>
      </section>

      <!-- Webhooks Section -->
      <section class="section-panel" id="section-int-webhooks">
        <div class="section-header">
          <h2>ğŸ”— Webhooks</h2>
          <button class="btn-primary" onclick="openModal('webhook')">+ Novo Webhook</button>
        </div>
        <p style="color:#94a3b8; margin-bottom:1.5rem;">Envie dados automaticamente para sistemas externos quando eventos ocorrerem.</p>
        <div class="table-container">
          <table>
            <thead>
              <tr><th>Nome</th><th>URL</th><th>Eventos</th><th>Status</th><th>AÃ§Ãµes</th></tr>
            </thead>
            <tbody id="webhooks-tbody">
              <tr><td colspan="5" class="loading">Carregando webhooks...</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- E-commerce Integrations Section -->
      <section class="section-panel" id="section-int-ecommerce">
        <div class="section-header">
          <h2>ğŸ›’ IntegraÃ§Ãµes E-commerce</h2>
        </div>
        <div class="integrations-list" id="ecommerce-integrations"></div>
      </section>

      <!-- Automation Integrations Section -->
      <section class="section-panel" id="section-int-automacao">
        <div class="section-header">
          <h2>âš™ï¸ IntegraÃ§Ãµes de AutomaÃ§Ã£o</h2>
        </div>
        <div class="integrations-list" id="automation-integrations"></div>
      </section>

      <!-- Backup Section -->
      <section class="section-panel" id="section-cfg-backup">
        <div class="section-header">
          <h2>ğŸ’¾ Backup e RestauraÃ§Ã£o</h2>
        </div>
        <div class="backup-cards">
          <div class="backup-card">
            <h3>ğŸ“¤ Exportar Dados</h3>
            <p style="color:#94a3b8; margin:1rem 0;">FaÃ§a download de todos os dados do sistema em formato JSON ou CSV.</p>
            <select id="export-format" style="padding:0.75rem; background:rgba(0,0,0,0.3); border:1px solid #334155; border-radius:10px; color:white; margin-right:1rem;">
              <option value="json">JSON</option>
              <option value="csv">CSV</option>
            </select>
            <button class="btn-primary" onclick="exportBackup()">Gerar Backup</button>
            <div class="last-backup" style="margin-top:1rem; font-size:0.85rem; color:#64748b;">
              Ãšltimo backup: <span id="last-backup-date">Nunca</span>
            </div>
          </div>
          <div class="backup-card">
            <h3>ğŸ“¥ Restaurar Dados</h3>
            <p style="color:#94a3b8; margin:1rem 0;">Importe um arquivo de backup para restaurar configuraÃ§Ãµes.</p>
            <input type="file" id="backup-file" accept=".json,.csv" style="display:none;" onchange="restoreBackup(this)" />
            <button class="btn-secondary" onclick="document.getElementById('backup-file').click()">Selecionar Arquivo</button>
          </div>
          <div class="backup-card">
            <h3>ğŸ”„ Backup AutomÃ¡tico</h3>
            <p style="color:#94a3b8; margin:1rem 0;">Configure backups automÃ¡ticos para o Google Drive ou S3.</p>
            <div style="display:flex; align-items:center; gap:1rem;">
              <label class="toggle-switch">
                <input type="checkbox" id="auto-backup-toggle" />
                <span class="toggle-slider"></span>
              </label>
              <span style="color:white;">Backup diÃ¡rio automÃ¡tico</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Email/SMTP Section -->
      <section class="section-panel" id="section-cfg-email">
        <div class="section-header">
          <h2>âœ‰ï¸ ConfiguraÃ§Ã£o de Email</h2>
        </div>
        <form class="config-form">
          <div class="form-row">
            <div class="form-group">
              <label>Servidor SMTP</label>
              <input type="text" id="smtp-host" placeholder="smtp.gmail.com" />
            </div>
            <div class="form-group">
              <label>Porta</label>
              <input type="number" id="smtp-port" value="587" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>UsuÃ¡rio</label>
              <input type="text" id="smtp-user" placeholder="seu@email.com" />
            </div>
            <div class="form-group">
              <label>Senha</label>
              <input type="password" id="smtp-pass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
            </div>
          </div>
          <div class="form-group">
            <label>Email Remetente</label>
            <input type="email" id="smtp-from" placeholder="noreply@empresa.com" />
          </div>
          <div style="display:flex; gap:1rem;">
            <button type="button" class="btn-secondary" onclick="testEmail()">ğŸ“§ Testar Envio</button>
            <button type="submit" class="btn-primary">Salvar SMTP</button>
          </div>
        </form>
      </section>

      <!-- API Tokens Section -->
      <section class="section-panel" id="section-cfg-api">
        <div class="section-header">
          <h2>ğŸ”‘ API e Tokens</h2>
          <button class="btn-primary" onclick="generateNewToken()">+ Gerar Novo Token</button>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr><th>Nome</th><th>Token</th><th>Criado em</th><th>Ãšltimo Uso</th><th>AÃ§Ãµes</th></tr>
            </thead>
            <tbody id="tokens-tbody">
              <tr>
                <td>API Principal</td>
                <td><code style="background:#1e293b; padding:0.3rem 0.6rem; border-radius:4px;">gnx_live_â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</code></td>
                <td>15/01/2026</td>
                <td>Hoje, 23:45</td>
                <td><button class="btn-sm" onclick="copyToken()">ğŸ“‹ Copiar</button></td>
              </tr>
            </tbody>
          </table>
        </div>
        <div style="margin-top:1.5rem; padding:1.5rem; background:rgba(0,212,255,0.1); border:1px solid rgba(0,212,255,0.2); border-radius:12px;">
          <h4 style="color:white; margin:0 0 0.5rem 0;">ğŸ“– DocumentaÃ§Ã£o da API</h4>
          <p style="color:#94a3b8; margin:0;">Acesse a documentaÃ§Ã£o completa em <a href="/api" target="_blank" style="color:#00d4ff;">getnexo.com.br/api</a></p>
        </div>
      </section>

      <!-- Pedidos Section -->
      <section class="section-panel" id="section-pedidos">
        <div class="section-header">
          <h2>ğŸ“¦ Gerenciar Pedidos</h2>
          <div style="display:flex; gap:1rem;">
            <select id="pedido-status-filter" class="filter-select" onchange="filterPedidos()">
              <option value="">Todos os Status</option>
              <option value="pending">Pendente</option>
              <option value="paid">Pago</option>
              <option value="shipped">Enviado</option>
              <option value="delivered">Entregue</option>
              <option value="cancelled">Cancelado</option>
            </select>
            <button class="btn-secondary" onclick="exportPedidos()">ğŸ“¥ Exportar</button>
          </div>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Pedido</th>
                <th>Cliente</th>
                <th>Produtos</th>
                <th>Total</th>
                <th>Status</th>
                <th>Data</th>
                <th>AÃ§Ãµes</th>
              </tr>
            </thead>
            <tbody id="pedidos-tbody">
              <tr><td colspan="7" class="loading">Carregando pedidos...</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Categorias Section -->
      <section class="section-panel" id="section-categorias">
        <div class="section-header">
          <h2>ğŸ“‚ Categorias</h2>
          <button class="btn-primary" onclick="openModal('categoria')">+ Nova Categoria</button>
        </div>
        <div class="categories-grid" id="categories-grid">
          <div class="loading">Carregando categorias...</div>
        </div>
      </section>

      <!-- Estoque Section -->
      <section class="section-panel" id="section-estoque">
        <div class="section-header">
          <h2>ğŸ“Š Controle de Estoque</h2>
          <button class="btn-secondary" onclick="exportEstoque()">ğŸ“¥ Exportar</button>
        </div>
        <div class="stats-grid" style="margin-bottom:1.5rem;">
          <div class="stat-card">
            <span class="stat-icon">ğŸ“¦</span>
            <div class="stat-info">
              <span class="stat-value" id="estoque-total">0</span>
              <span class="stat-label">Itens em Estoque</span>
            </div>
          </div>
          <div class="stat-card">
            <span class="stat-icon">âš ï¸</span>
            <div class="stat-info">
              <span class="stat-value" id="estoque-baixo">0</span>
              <span class="stat-label">Estoque Baixo</span>
            </div>
          </div>
          <div class="stat-card">
            <span class="stat-icon">âŒ</span>
            <div class="stat-info">
              <span class="stat-value" id="estoque-zerado">0</span>
              <span class="stat-label">Sem Estoque</span>
            </div>
          </div>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr><th>Produto</th><th>SKU</th><th>Estoque Atual</th><th>Estoque MÃ­nimo</th><th>Status</th><th>AÃ§Ãµes</th></tr>
            </thead>
            <tbody id="estoque-tbody">
              <tr><td colspan="6" class="loading">Carregando estoque...</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Bot Config Section -->
      <section class="section-panel" id="section-bot-config">
        <div class="section-header">
          <h2>ğŸ¤– ConfiguraÃ§Ã£o do Bot</h2>
        </div>
        <div class="config-form">
          <div class="form-row">
            <div class="form-group">
              <label>Nome do Bot</label>
              <input type="text" id="bot-name" value="Nexo" placeholder="Nome exibido ao cliente" />
            </div>
            <div class="form-group">
              <label>Idioma Principal</label>
              <select id="bot-lang">
                <option value="pt-BR" selected>PortuguÃªs (Brasil)</option>
                <option value="en">English</option>
                <option value="es">EspaÃ±ol</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label>SaudaÃ§Ã£o Inicial</label>
            <textarea id="bot-greeting" rows="3">OlÃ¡! ğŸ‘‹ Sou o assistente virtual do GetNexo. Como posso ajudar vocÃª hoje?</textarea>
          </div>
          <div class="form-group">
            <label>Mensagem de Despedida</label>
            <textarea id="bot-farewell" rows="2">Foi um prazer ajudar! ğŸ˜Š Volte sempre!</textarea>
          </div>
          <div class="form-row">
            <div class="form-group" style="display:flex; align-items:center; gap:1rem;">
              <label class="toggle-switch">
                <input type="checkbox" id="bot-auto-reply" checked />
                <span class="toggle-slider"></span>
              </label>
              <span style="color:white;">Resposta AutomÃ¡tica</span>
            </div>
            <div class="form-group" style="display:flex; align-items:center; gap:1rem;">
              <label class="toggle-switch">
                <input type="checkbox" id="bot-typing" checked />
                <span class="toggle-slider"></span>
              </label>
              <span style="color:white;">Simular DigitaÃ§Ã£o</span>
            </div>
          </div>
          <div class="form-group">
            <label>Tempo de Espera (segundos)</label>
            <input type="number" id="bot-delay" value="2" min="0" max="10" style="width:100px;" />
          </div>
          <button class="btn-primary" onclick="saveBotConfig()">Salvar ConfiguraÃ§Ãµes</button>
        </div>
      </section>

      <!-- Filas Section -->
      <section class="section-panel" id="section-filas">
        <div class="section-header">
          <h2>ğŸ“‹ Filas de Atendimento</h2>
          <button class="btn-primary" onclick="openModal('fila')">+ Nova Fila</button>
        </div>
        <div class="queues-grid" id="queues-grid">
          <div class="queue-card">
            <div class="queue-header">
              <h3>ğŸ›’ Vendas</h3>
              <span class="queue-count">5 em espera</span>
            </div>
            <div class="queue-agents">
              <span>Agentes: JoÃ£o, Maria</span>
            </div>
            <div class="queue-actions">
              <button class="btn-sm">âœï¸ Editar</button>
              <label class="toggle-switch">
                <input type="checkbox" checked />
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>
          <div class="queue-card">
            <div class="queue-header">
              <h3>ğŸ”§ Suporte</h3>
              <span class="queue-count">2 em espera</span>
            </div>
            <div class="queue-agents">
              <span>Agentes: Carlos</span>
            </div>
            <div class="queue-actions">
              <button class="btn-sm">âœï¸ Editar</button>
              <label class="toggle-switch">
                <input type="checkbox" checked />
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>
        </div>
      </section>

      <!-- SessÃµes Section -->
      <section class="section-panel" id="section-seg-sessoes">
        <div class="section-header">
          <h2>ğŸ” SessÃµes Ativas</h2>
          <button class="btn-danger" onclick="revokeAllSessions()">ğŸš« Encerrar Todas</button>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr><th>UsuÃ¡rio</th><th>IP</th><th>Dispositivo</th><th>LocalizaÃ§Ã£o</th><th>Iniciada em</th><th>AÃ§Ãµes</th></tr>
            </thead>
            <tbody id="sessions-tbody">
              <tr>
                <td>Admin User</td>
                <td><code>177.45.xxx.xxx</code></td>
                <td>Chrome / Linux</td>
                <td>SÃ£o Paulo, BR</td>
                <td>HÃ¡ 2 horas</td>
                <td>
                  <span class="status-badge online" style="font-size:0.75rem;">SessÃ£o Atual</span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Bloqueio de IPs Section -->
      <section class="section-panel" id="section-seg-ips">
        <div class="section-header">
          <h2>ğŸš« Bloqueio de IPs</h2>
          <button class="btn-primary" onclick="openModal('bloqueio-ip')">+ Bloquear IP</button>
        </div>
        <div class="alert-info" style="background:rgba(239,68,68,0.1); border:1px solid rgba(239,68,68,0.3); border-radius:12px; padding:1rem; margin-bottom:1.5rem;">
          <p style="color:#f87171; margin:0;">âš ï¸ IPs bloqueados nÃ£o poderÃ£o acessar o sistema. Use com cautela.</p>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr><th>IP</th><th>Motivo</th><th>Bloqueado por</th><th>Data</th><th>AÃ§Ãµes</th></tr>
            </thead>
            <tbody id="blocked-ips-tbody">
              <tr><td colspan="5" class="loading">Nenhum IP bloqueado</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- NotificaÃ§Ãµes Config Section -->
      <section class="section-panel" id="section-cfg-notificacoes">
        <div class="section-header">
          <h2>ğŸ”” ConfiguraÃ§Ã£o de NotificaÃ§Ãµes</h2>
        </div>
        <div class="config-form">
          <h4 style="color:white; margin-bottom:1rem;">ğŸ“§ NotificaÃ§Ãµes por Email</h4>
          <div class="notifications-grid">
            <div class="notification-item">
              <label class="toggle-switch">
                <input type="checkbox" checked data-notif="new_order" />
                <span class="toggle-slider"></span>
              </label>
              <span>Novo pedido recebido</span>
            </div>
            <div class="notification-item">
              <label class="toggle-switch">
                <input type="checkbox" checked data-notif="new_lead" />
                <span class="toggle-slider"></span>
              </label>
              <span>Novo lead capturado</span>
            </div>
            <div class="notification-item">
              <label class="toggle-switch">
                <input type="checkbox" data-notif="low_stock" />
                <span class="toggle-slider"></span>
              </label>
              <span>Estoque baixo</span>
            </div>
            <div class="notification-item">
              <label class="toggle-switch">
                <input type="checkbox" data-notif="new_message" />
                <span class="toggle-slider"></span>
              </label>
              <span>Nova mensagem (quando offline)</span>
            </div>
          </div>
          
          <h4 style="color:white; margin:2rem 0 1rem;">ğŸ“± NotificaÃ§Ãµes Push</h4>
          <div class="notifications-grid">
            <div class="notification-item">
              <label class="toggle-switch">
                <input type="checkbox" checked data-push="order" />
                <span class="toggle-slider"></span>
              </label>
              <span>Push no navegador</span>
            </div>
            <div class="notification-item">
              <label class="toggle-switch">
                <input type="checkbox" data-push="sound" />
                <span class="toggle-slider"></span>
              </label>
              <span>Som de notificaÃ§Ã£o</span>
            </div>
          </div>
          
          <button class="btn-primary" style="margin-top:1.5rem;" onclick="saveNotifications()">Salvar PreferÃªncias</button>
        </div>
      </section>

      <!-- RelatÃ³rio Vendas Section -->
      <section class="section-panel" id="section-rel-vendas">
        <div class="section-header">
          <h2>ğŸ“Š RelatÃ³rio de Vendas</h2>
          <div style="display:flex; gap:1rem;">
            <select id="rel-vendas-periodo" class="filter-select">
              <option value="7d">Ãšltimos 7 dias</option>
              <option value="30d" selected>Ãšltimos 30 dias</option>
              <option value="90d">Ãšltimos 90 dias</option>
              <option value="1y">Ãšltimo ano</option>
            </select>
            <button class="btn-secondary" onclick="exportRelVendas()">ğŸ“¥ Exportar</button>
          </div>
        </div>
        <div class="stats-grid">
          <div class="stat-card">
            <span class="stat-icon">ğŸ’°</span>
            <div class="stat-info">
              <span class="stat-value" id="rel-total-vendas">R$ 0</span>
              <span class="stat-label">Faturamento Total</span>
            </div>
          </div>
          <div class="stat-card">
            <span class="stat-icon">ğŸ›’</span>
            <div class="stat-info">
              <span class="stat-value" id="rel-qtd-pedidos">0</span>
              <span class="stat-label">Pedidos</span>
            </div>
          </div>
          <div class="stat-card">
            <span class="stat-icon">ğŸ“ˆ</span>
            <div class="stat-info">
              <span class="stat-value" id="rel-ticket-medio">R$ 0</span>
              <span class="stat-label">Ticket MÃ©dio</span>
            </div>
          </div>
          <div class="stat-card">
            <span class="stat-icon">ğŸ”„</span>
            <div class="stat-info">
              <span class="stat-value" id="rel-taxa-conversao">0%</span>
              <span class="stat-label">Taxa de ConversÃ£o</span>
            </div>
          </div>
        </div>
        <div class="chart-container" style="margin-top:1.5rem; background:rgba(20,30,50,0.6); border:1px solid #1f2937; border-radius:16px; padding:1.5rem;">
          <canvas id="chart-vendas" height="300"></canvas>
        </div>
      </section>

      <!-- RelatÃ³rio Leads Section -->
      <section class="section-panel" id="section-rel-leads">
        <div class="section-header">
          <h2>ğŸ‘¥ RelatÃ³rio de Leads</h2>
          <button class="btn-secondary" onclick="exportRelLeads()">ğŸ“¥ Exportar</button>
        </div>
        <div class="stats-grid">
          <div class="stat-card">
            <span class="stat-icon">ğŸ‘¥</span>
            <div class="stat-info">
              <span class="stat-value" id="rel-total-leads">0</span>
              <span class="stat-label">Total de Leads</span>
            </div>
          </div>
          <div class="stat-card">
            <span class="stat-icon">ğŸ†•</span>
            <div class="stat-info">
              <span class="stat-value" id="rel-novos-leads">0</span>
              <span class="stat-label">Novos (30 dias)</span>
            </div>
          </div>
          <div class="stat-card">
            <span class="stat-icon">âœ…</span>
            <div class="stat-info">
              <span class="stat-value" id="rel-convertidos">0</span>
              <span class="stat-label">Convertidos</span>
            </div>
          </div>
        </div>
        <div class="table-container" style="margin-top:1.5rem;">
          <table>
            <thead>
              <tr><th>Fonte</th><th>Leads</th><th>ConversÃµes</th><th>Taxa</th></tr>
            </thead>
            <tbody id="leads-source-tbody">
              <tr><td>WhatsApp</td><td>245</td><td>89</td><td><span class="status-badge online">36.3%</span></td></tr>
              <tr><td>Site</td><td>128</td><td>34</td><td><span class="status-badge">26.6%</span></td></tr>
              <tr><td>Instagram</td><td>67</td><td>12</td><td><span class="status-badge">17.9%</span></td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- RelatÃ³rio Atendimento Section -->
      <section class="section-panel" id="section-rel-atendimento">
        <div class="section-header">
          <h2>ğŸ’¬ RelatÃ³rio de Atendimento</h2>
          <button class="btn-secondary" onclick="exportRelAtendimento()">ğŸ“¥ Exportar</button>
        </div>
        <div class="stats-grid">
          <div class="stat-card">
            <span class="stat-icon">ğŸ’¬</span>
            <div class="stat-info">
              <span class="stat-value" id="rel-total-conversas">0</span>
              <span class="stat-label">Conversas</span>
            </div>
          </div>
          <div class="stat-card">
            <span class="stat-icon">â±ï¸</span>
            <div class="stat-info">
              <span class="stat-value" id="rel-tempo-resposta">0s</span>
              <span class="stat-label">Tempo MÃ©dio Resposta</span>
            </div>
          </div>
          <div class="stat-card">
            <span class="stat-icon">â­</span>
            <div class="stat-info">
              <span class="stat-value" id="rel-csat">0%</span>
              <span class="stat-label">SatisfaÃ§Ã£o (CSAT)</span>
            </div>
          </div>
          <div class="stat-card">
            <span class="stat-icon">ğŸ¤–</span>
            <div class="stat-info">
              <span class="stat-value" id="rel-bot-taxa">0%</span>
              <span class="stat-label">Resolvido pelo Bot</span>
            </div>
          </div>
        </div>
      </section>

      <!-- RelatÃ³rio Performance Section -->
      <section class="section-panel" id="section-rel-performance">
        <div class="section-header">
          <h2>âš¡ Performance do Sistema</h2>
        </div>
        <div class="stats-grid">
          <div class="stat-card">
            <span class="stat-icon">ğŸš€</span>
            <div class="stat-info">
              <span class="stat-value" id="perf-uptime">99.9%</span>
              <span class="stat-label">Uptime</span>
            </div>
          </div>
          <div class="stat-card">
            <span class="stat-icon">â±ï¸</span>
            <div class="stat-info">
              <span class="stat-value" id="perf-latencia">42ms</span>
              <span class="stat-label">LatÃªncia MÃ©dia</span>
            </div>
          </div>
          <div class="stat-card">
            <span class="stat-icon">ğŸ”Œ</span>
            <div class="stat-info">
              <span class="stat-value" id="perf-conexoes">1.2k</span>
              <span class="stat-label">ConexÃµes Ativas</span>
            </div>
          </div>
          <div class="stat-card">
            <span class="stat-icon">ğŸ“¤</span>
            <div class="stat-info">
              <span class="stat-value" id="perf-mensagens">45k</span>
              <span class="stat-label">Mensagens/dia</span>
            </div>
          </div>
        </div>
        <div class="services-status" style="margin-top:1.5rem;">
          <h4 style="color:white; margin-bottom:1rem;">Status dos ServiÃ§os</h4>
          <div class="services-grid">
            <div class="service-item"><span class="status-badge online">â—</span> WhatsApp API</div>
            <div class="service-item"><span class="status-badge online">â—</span> Backend API</div>
            <div class="service-item"><span class="status-badge online">â—</span> Database</div>
            <div class="service-item"><span class="status-badge online">â—</span> AI Service</div>
            <div class="service-item"><span class="status-badge online">â—</span> Email Service</div>
            <div class="service-item"><span class="status-badge online">â—</span> Storage</div>
          </div>
        </div>
      </section>

      <!-- Exportar Section -->
      <section class="section-panel" id="section-rel-exportar">
        <div class="section-header">
          <h2>ğŸ“¥ Exportar Dados</h2>
        </div>
        <div class="export-cards">
          <div class="export-card" onclick="exportData('vendas')">
            <span class="export-icon">ğŸ’°</span>
            <h3>Vendas</h3>
            <p>Pedidos, transaÃ§Ãµes, faturamento</p>
          </div>
          <div class="export-card" onclick="exportData('leads')">
            <span class="export-icon">ğŸ‘¥</span>
            <h3>Leads</h3>
            <p>Contatos, origem, conversÃµes</p>
          </div>
          <div class="export-card" onclick="exportData('produtos')">
            <span class="export-icon">ğŸ“¦</span>
            <h3>Produtos</h3>
            <p>CatÃ¡logo, preÃ§os, estoque</p>
          </div>
          <div class="export-card" onclick="exportData('conversas')">
            <span class="export-icon">ğŸ’¬</span>
            <h3>Conversas</h3>
            <p>HistÃ³rico de mensagens</p>
          </div>
          <div class="export-card" onclick="exportData('clientes')">
            <span class="export-icon">ğŸ¢</span>
            <h3>Clientes</h3>
            <p>Dados de clientes</p>
          </div>
          <div class="export-card" onclick="exportData('auditoria')">
            <span class="export-icon">ğŸ“‹</span>
            <h3>Logs</h3>
            <p>Auditoria e atividades</p>
          </div>
        </div>
      </section>

      <!-- IA HistÃ³rico Section -->
      <section class="section-panel" id="section-ia-historico">
        <div class="section-header">
          <h2>ğŸ“œ HistÃ³rico de IA</h2>
          <button class="btn-secondary" onclick="clearIAHistory()">ğŸ—‘ï¸ Limpar HistÃ³rico</button>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr><th>Data</th><th>UsuÃ¡rio</th><th>Pergunta</th><th>Resposta</th><th>Modelo</th></tr>
            </thead>
            <tbody id="ia-history-tbody">
              <tr><td colspan="5" class="loading">Carregando histÃ³rico...</td></tr>
            </tbody>
          </table>
        </div>
      </section>

    </div>
  </main>
</div>

<!-- Command Palette Modal -->
<div class="command-palette" id="command-palette" style="display:none;">
  <div class="command-content">
    <input type="text" id="command-input" placeholder="Digite um comando ou busque..." autofocus />
    <div class="command-results" id="command-results">
      <div class="command-group">
        <span class="command-group-title">AÃ§Ãµes RÃ¡pidas</span>
        <button class="command-item" data-action="produtos">ğŸ›ï¸ Ir para Produtos</button>
        <button class="command-item" data-action="cupons">ğŸŸï¸ Ir para Cupons</button>
        <button class="command-item" data-action="campanhas">ğŸ“¢ Ir para Campanhas</button>
        <button class="command-item" data-action="ia-provedores">ğŸ¤– Configurar IA</button>
        <button class="command-item" data-action="macros">âš¡ Macros</button>
        <button class="command-item" data-action="horarios">ğŸ• HorÃ¡rios</button>
        <button class="command-item" data-action="int-webhooks">ğŸ”— Webhooks</button>
        <button class="command-item" data-action="cfg-backup">ğŸ’¾ Backup</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Produto -->
<div class="modal-overlay" id="modal-produto" style="display:none;">
  <div class="modal-content">
    <div class="modal-header">
      <h2 id="modal-produto-title">Novo Produto</h2>
      <button class="modal-close" onclick="closeModal('produto')">&times;</button>
    </div>
    <form id="form-produto" onsubmit="saveProduto(event)">
      <input type="hidden" id="produto-id" />
      <div class="form-row">
        <div class="form-group">
          <label>Nome do Produto *</label>
          <input type="text" id="produto-nome" required placeholder="Ex: Camiseta Premium" />
        </div>
        <div class="form-group">
          <label>SKU</label>
          <input type="text" id="produto-sku" placeholder="SKU-001" />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>PreÃ§o *</label>
          <input type="number" id="produto-preco" required step="0.01" min="0" placeholder="99.90" />
        </div>
        <div class="form-group">
          <label>PreÃ§o Promocional</label>
          <input type="number" id="produto-preco-promo" step="0.01" min="0" placeholder="79.90" />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Estoque</label>
          <input type="number" id="produto-estoque" min="0" placeholder="100" />
        </div>
        <div class="form-group">
          <label>Categoria</label>
          <select id="produto-categoria">
            <option value="">Selecione...</option>
            <option value="roupas">Roupas</option>
            <option value="eletronicos">EletrÃ´nicos</option>
            <option value="acessorios">AcessÃ³rios</option>
            <option value="outros">Outros</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label>DescriÃ§Ã£o</label>
        <textarea id="produto-descricao" rows="3" placeholder="Descreva o produto..."></textarea>
      </div>
      <div class="form-group">
        <label>URL da Imagem</label>
        <input type="url" id="produto-imagem" placeholder="https://..." />
      </div>
      <div class="form-group" style="display:flex; align-items:center; gap:1rem;">
        <label class="toggle-switch">
          <input type="checkbox" id="produto-ativo" checked />
          <span class="toggle-slider"></span>
        </label>
        <span style="color:white;">Produto Ativo</span>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn-secondary" onclick="closeModal('produto')">Cancelar</button>
        <button type="submit" class="btn-primary">Salvar Produto</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal Cupom -->
<div class="modal-overlay" id="modal-cupom" style="display:none;">
  <div class="modal-content">
    <div class="modal-header">
      <h2 id="modal-cupom-title">Novo Cupom</h2>
      <button class="modal-close" onclick="closeModal('cupom')">&times;</button>
    </div>
    <form id="form-cupom" onsubmit="saveCupom(event)">
      <input type="hidden" id="cupom-id" />
      <div class="form-row">
        <div class="form-group">
          <label>CÃ³digo do Cupom *</label>
          <input type="text" id="cupom-codigo" required placeholder="PROMO20" style="text-transform:uppercase;" />
        </div>
        <div class="form-group">
          <label>Tipo de Desconto *</label>
          <select id="cupom-tipo" required>
            <option value="percent">Porcentagem (%)</option>
            <option value="fixed">Valor Fixo (R$)</option>
            <option value="frete">Frete GrÃ¡tis</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Valor do Desconto *</label>
          <input type="number" id="cupom-valor" required min="0" step="0.01" placeholder="20" />
        </div>
        <div class="form-group">
          <label>Valor MÃ­nimo do Pedido</label>
          <input type="number" id="cupom-minimo" min="0" step="0.01" placeholder="100" />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Data de ExpiraÃ§Ã£o</label>
          <input type="date" id="cupom-expira" />
        </div>
        <div class="form-group">
          <label>Limite de Usos</label>
          <input type="number" id="cupom-limite" min="0" placeholder="Ilimitado" />
        </div>
      </div>
      <div class="form-group">
        <label>DescriÃ§Ã£o</label>
        <input type="text" id="cupom-descricao" placeholder="DescriÃ§Ã£o interna do cupom" />
      </div>
      <div class="form-group" style="display:flex; align-items:center; gap:1rem;">
        <label class="toggle-switch">
          <input type="checkbox" id="cupom-ativo" checked />
          <span class="toggle-slider"></span>
        </label>
        <span style="color:white;">Cupom Ativo</span>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn-secondary" onclick="closeModal('cupom')">Cancelar</button>
        <button type="submit" class="btn-primary">Salvar Cupom</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal Macro -->
<div class="modal-overlay" id="modal-macro" style="display:none;">
  <div class="modal-content">
    <div class="modal-header">
      <h2 id="modal-macro-title">Nova Macro</h2>
      <button class="modal-close" onclick="closeModal('macro')">&times;</button>
    </div>
    <form id="form-macro" onsubmit="saveMacro(event)">
      <input type="hidden" id="macro-id" />
      <div class="form-row">
        <div class="form-group">
          <label>Atalho *</label>
          <input type="text" id="macro-atalho" required placeholder="/ola" />
          <small style="color:#64748b;">Use / para iniciar (ex: /preco, /horario)</small>
        </div>
        <div class="form-group">
          <label>TÃ­tulo *</label>
          <input type="text" id="macro-titulo" required placeholder="SaudaÃ§Ã£o inicial" />
        </div>
      </div>
      <div class="form-group">
        <label>ConteÃºdo da Resposta *</label>
        <textarea id="macro-conteudo" rows="5" required placeholder="OlÃ¡! ğŸ‘‹ Seja bem-vindo(a) ao GetNexo!

Como posso ajudar vocÃª hoje?"></textarea>
        <small style="color:#64748b;">Use {'{nome}'} para nome do cliente, {'{produto}'} para Ãºltimo produto visto</small>
      </div>
      <div class="form-group">
        <label>Categoria</label>
        <select id="macro-categoria">
          <option value="geral">Geral</option>
          <option value="vendas">Vendas</option>
          <option value="suporte">Suporte</option>
          <option value="financeiro">Financeiro</option>
        </select>
      </div>
      <div class="form-group" style="display:flex; align-items:center; gap:1rem;">
        <label class="toggle-switch">
          <input type="checkbox" id="macro-ativo" checked />
          <span class="toggle-slider"></span>
        </label>
        <span style="color:white;">Macro Ativa</span>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn-secondary" onclick="closeModal('macro')">Cancelar</button>
        <button type="submit" class="btn-primary">Salvar Macro</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal Campanha -->
<div class="modal-overlay" id="modal-campanha" style="display:none;">
  <div class="modal-content modal-lg">
    <div class="modal-header">
      <h2 id="modal-campanha-title">Nova Campanha</h2>
      <button class="modal-close" onclick="closeModal('campanha')">&times;</button>
    </div>
    <form id="form-campanha" onsubmit="saveCampanha(event)">
      <input type="hidden" id="campanha-id" />
      <div class="form-row">
        <div class="form-group">
          <label>Nome da Campanha *</label>
          <input type="text" id="campanha-nome" required placeholder="Black Friday 2026" />
        </div>
        <div class="form-group">
          <label>Tipo</label>
          <select id="campanha-tipo">
            <option value="broadcast">Broadcast (Envio em massa)</option>
            <option value="drip">Drip Campaign (SequÃªncia)</option>
            <option value="trigger">Trigger (Gatilho)</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label>Mensagem *</label>
        <textarea id="campanha-mensagem" rows="5" required placeholder="ğŸ”¥ Black Friday GetNexo!

Aproveite 50% de desconto em todos os planos!

Use o cupom: BLACK50"></textarea>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>SegmentaÃ§Ã£o</label>
          <select id="campanha-segmento" multiple>
            <option value="todos" selected>Todos os contatos</option>
            <option value="clientes">Clientes ativos</option>
            <option value="leads">Leads nÃ£o convertidos</option>
            <option value="inativos">Contatos inativos (30+ dias)</option>
          </select>
        </div>
        <div class="form-group">
          <label>Agendamento</label>
          <input type="datetime-local" id="campanha-agenda" />
          <small style="color:#64748b;">Deixe vazio para envio imediato</small>
        </div>
      </div>
      <div class="form-group">
        <label>Anexo (opcional)</label>
        <input type="url" id="campanha-anexo" placeholder="URL da imagem ou documento" />
      </div>
      <div class="modal-actions">
        <button type="button" class="btn-secondary" onclick="closeModal('campanha')">Cancelar</button>
        <button type="submit" class="btn-primary">Criar Campanha</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal Webhook -->
<div class="modal-overlay" id="modal-webhook" style="display:none;">
  <div class="modal-content">
    <div class="modal-header">
      <h2 id="modal-webhook-title">Novo Webhook</h2>
      <button class="modal-close" onclick="closeModal('webhook')">&times;</button>
    </div>
    <form id="form-webhook" onsubmit="saveWebhook(event)">
      <input type="hidden" id="webhook-id" />
      <div class="form-group">
        <label>Nome *</label>
        <input type="text" id="webhook-nome" required placeholder="NotificaÃ§Ã£o CRM" />
      </div>
      <div class="form-group">
        <label>URL do Webhook *</label>
        <input type="url" id="webhook-url" required placeholder="https://seu-sistema.com/webhook" />
      </div>
      <div class="form-group">
        <label>Eventos (selecione um ou mais)</label>
        <div class="checkbox-grid">
          <label class="checkbox-item"><input type="checkbox" value="new_message" /> Nova Mensagem</label>
          <label class="checkbox-item"><input type="checkbox" value="new_lead" /> Novo Lead</label>
          <label class="checkbox-item"><input type="checkbox" value="new_order" /> Novo Pedido</label>
          <label class="checkbox-item"><input type="checkbox" value="order_paid" /> Pedido Pago</label>
          <label class="checkbox-item"><input type="checkbox" value="cart_abandoned" /> Carrinho Abandonado</label>
          <label class="checkbox-item"><input type="checkbox" value="ticket_created" /> Ticket Criado</label>
        </div>
      </div>
      <div class="form-group">
        <label>Headers (JSON)</label>
        <textarea id="webhook-headers" rows="3" placeholder='{"Authorization": "Bearer token"}'></textarea>
      </div>
      <div class="form-group" style="display:flex; align-items:center; gap:1rem;">
        <label class="toggle-switch">
          <input type="checkbox" id="webhook-ativo" checked />
          <span class="toggle-slider"></span>
        </label>
        <span style="color:white;">Webhook Ativo</span>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn-secondary" onclick="closeModal('webhook')">Cancelar</button>
        <button type="button" class="btn-outline" onclick="testWebhook()">ğŸ§ª Testar</button>
        <button type="submit" class="btn-primary">Salvar Webhook</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal Categoria -->
<div class="modal-overlay" id="modal-categoria" style="display:none;">
  <div class="modal-content">
    <div class="modal-header">
      <h2 id="modal-categoria-title">Nova Categoria</h2>
      <button class="modal-close" onclick="closeModal('categoria')">&times;</button>
    </div>
    <form id="form-categoria" onsubmit="saveCategoria(event)">
      <input type="hidden" id="categoria-id" />
      <div class="form-group">
        <label>Nome da Categoria *</label>
        <input type="text" id="categoria-nome" required placeholder="Ex: Roupas" />
      </div>
      <div class="form-group">
        <label>Slug (URL) *</label>
        <input type="text" id="categoria-slug" required placeholder="roupas" />
      </div>
      <div class="form-group">
        <label>DescriÃ§Ã£o</label>
        <textarea id="categoria-descricao" rows="3" placeholder="DescriÃ§Ã£o para SEO"></textarea>
      </div>
      <div class="form-group" style="display:flex; align-items:center; gap:1rem;">
        <label class="toggle-switch">
          <input type="checkbox" id="categoria-ativa" checked />
          <span class="toggle-slider"></span>
        </label>
        <span style="color:white;">Categoria Ativa</span>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn-secondary" onclick="closeModal('categoria')">Cancelar</button>
        <button type="submit" class="btn-primary">Salvar Categoria</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal Fila -->
<div class="modal-overlay" id="modal-fila" style="display:none;">
  <div class="modal-content">
    <div class="modal-header">
      <h2 id="modal-fila-title">Nova Fila</h2>
      <button class="modal-close" onclick="closeModal('fila')">&times;</button>
    </div>
    <form id="form-fila" onsubmit="saveFila(event)">
      <input type="hidden" id="fila-id" />
      <div class="form-group">
        <label>Nome da Fila *</label>
        <input type="text" id="fila-nome" required placeholder="Ex: Suporte Financeiro" />
      </div>
      <div class="form-group">
        <label>Agentes (selecione mÃºltiplos)</label>
        <select id="fila-agentes" multiple>
          <option value="joao">JoÃ£o</option>
          <option value="maria">Maria</option>
          <option value="carlos">Carlos</option>
          <option value="ana">Ana</option>
        </select>
        <small style="color:#64748b;">Segure Ctrl/Cmd para selecionar vÃ¡rios</small>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Cor</label>
          <input type="color" id="fila-cor" value="#00d4ff" style="height:40px; width:100%; border-radius:8px; border:none;" />
        </div>
        <div class="form-group">
          <label>Prioridade</label>
          <select id="fila-prioridade">
            <option value="1">Baixa</option>
            <option value="2" selected>Normal</option>
            <option value="3">Alta</option>
          </select>
        </div>
      </div>
      <div class="form-group" style="display:flex; align-items:center; gap:1rem;">
        <label class="toggle-switch">
          <input type="checkbox" id="fila-ativa" checked />
          <span class="toggle-slider"></span>
        </label>
        <span style="color:white;">Fila Ativa</span>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn-secondary" onclick="closeModal('fila')">Cancelar</button>
        <button type="submit" class="btn-primary">Salvar Fila</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal Bloqueio IP -->
<div class="modal-overlay" id="modal-bloqueio-ip" style="display:none;">
  <div class="modal-content">
    <div class="modal-header">
      <h2 id="modal-bloqueio-ip-title">Bloquear IP</h2>
      <button class="modal-close" onclick="closeModal('bloqueio-ip')">&times;</button>
    </div>
    <form id="form-bloqueio-ip" onsubmit="saveBloqueioIP(event)">
      <div class="form-group">
        <label>EndereÃ§o IP *</label>
        <input type="text" id="ip-endereco" required placeholder="192.168.1.1" pattern="^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$" />
      </div>
      <div class="form-group">
        <label>Motivo do Bloqueio *</label>
        <select id="ip-motivo" required>
          <option value="ataque">Tentativa de Ataque</option>
          <option value="spam">Spam / Abuso</option>
          <option value="bot">Bot Malicioso</option>
          <option value="outros">Outros</option>
        </select>
      </div>
      <div class="form-group">
        <label>ObservaÃ§Ãµes</label>
        <textarea id="ip-obs" rows="3" placeholder="Detalhes adicionais..."></textarea>
      </div>
      <div class="form-group" style="display:flex; align-items:center; gap:1rem;">
        <label class="toggle-switch">
          <input type="checkbox" id="ip-permanente" checked />
          <span class="toggle-slider"></span>
        </label>
        <span style="color:white;">Bloqueio Permanente</span>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn-secondary" onclick="closeModal('bloqueio-ip')">Cancelar</button>
        <button type="submit" class="btn-danger">ğŸš« Bloquear IP</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal ConfirmaÃ§Ã£o -->
<div class="modal-overlay" id="modal-confirm" style="display:none;">
  <div class="modal-content modal-sm">
    <div class="modal-header">
      <h2>Confirmar AÃ§Ã£o</h2>
      <button class="modal-close" onclick="closeModal('confirm')">&times;</button>
    </div>
    <p id="confirm-message" style="color:#94a3b8; margin:1.5rem 0;">Tem certeza que deseja continuar?</p>
    <div class="modal-actions">
      <button class="btn-secondary" onclick="closeModal('confirm')">Cancelar</button>
      <button class="btn-danger" id="confirm-btn" onclick="confirmAction()">Confirmar</button>
    </div>
  </div>
</div>

<!-- Toast Notification -->
<div class="toast-container" id="toast-container"></div>

</Layout>

<style>
  .admin-central {
    display: flex;
    min-height: 100vh;
    background: #030712;
  }

  /* Sidebar */
  .sidebar {
    width: 280px;
    background: #0a0e17;
    border-right: 1px solid #1f2937;
    display: flex;
    flex-direction: column;
    transition: width 0.3s;
    position: fixed;
    height: 100vh;
    z-index: 100;
  }

  .sidebar.collapsed {
    width: 70px;
  }

  .sidebar.collapsed .nav-text,
  .sidebar.collapsed .nav-arrow,
  .sidebar.collapsed .logo-text,
  .sidebar.collapsed .search-box {
    display: none;
  }

  .sidebar-header {
    padding: 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #1f2937;
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .logo-icon {
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, #00d4ff, #00ff9d);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 900;
    color: black;
    font-size: 1.2rem;
  }

  .logo-text {
    font-size: 1.3rem;
    font-weight: 800;
    color: white;
  }

  .accent { color: #00ff9d; }

  .toggle-btn {
    background: transparent;
    border: none;
    color: #64748b;
    font-size: 1.2rem;
    cursor: pointer;
    padding: 0.5rem;
  }

  .search-box {
    padding: 1rem 1.5rem;
  }

  .search-box input {
    width: 100%;
    padding: 0.7rem 1rem;
    background: rgba(255,255,255,0.05);
    border: 1px solid #1f2937;
    border-radius: 8px;
    color: white;
    font-size: 0.9rem;
  }

  .search-box input:focus {
    outline: none;
    border-color: #00d4ff;
  }

  .sidebar-nav {
    flex: 1;
    overflow-y: auto;
    padding: 1rem 0;
  }

  .nav-section {
    margin-bottom: 0.5rem;
  }

  .nav-item, .nav-group-btn {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1.5rem;
    color: #94a3b8;
    text-decoration: none;
    width: 100%;
    background: transparent;
    border: none;
    cursor: pointer;
    font-size: 0.95rem;
    transition: 0.2s;
    text-align: left;
  }

  .nav-item:hover, .nav-group-btn:hover {
    background: rgba(0,212,255,0.1);
    color: white;
  }

  .nav-item.active {
    background: rgba(0,212,255,0.15);
    color: #00d4ff;
    border-left: 3px solid #00d4ff;
  }

  .nav-icon { font-size: 1.1rem; }
  .nav-arrow { margin-left: auto; font-size: 0.7rem; transition: 0.2s; }
  .nav-group-btn[aria-expanded="true"] .nav-arrow { transform: rotate(180deg); }

  .nav-submenu {
    display: none;
    padding-left: 3rem;
  }

  .nav-submenu.open { display: block; }

  .nav-subitem {
    display: block;
    padding: 0.5rem 1rem;
    color: #64748b;
    text-decoration: none;
    font-size: 0.9rem;
    transition: 0.2s;
    border-radius: 6px;
    margin: 0.2rem 0;
  }

  .nav-subitem:hover {
    color: white;
    background: rgba(255,255,255,0.05);
  }

  .nav-subitem.active {
    color: #00ff9d;
  }

  .sidebar-footer {
    padding: 1rem;
    border-top: 1px solid #1f2937;
  }

  .logout:hover { color: #ef4444 !important; }

  /* Main Content */
  .main-content {
    flex: 1;
    margin-left: 280px;
    display: flex;
    flex-direction: column;
    transition: margin-left 0.3s;
  }

  .sidebar.collapsed + .main-content {
    margin-left: 70px;
  }

  .content-header {
    height: 70px;
    background: #0a0e17;
    border-bottom: 1px solid #1f2937;
    padding: 0 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: sticky;
    top: 0;
    z-index: 50;
  }

  .header-left h1 {
    font-size: 1.5rem;
    color: white;
    margin: 0;
  }

  .breadcrumb {
    color: #64748b;
    font-size: 0.85rem;
  }

  .header-right {
    display: flex;
    align-items: center;
    gap: 1.5rem;
  }

  .status-badge {
    padding: 0.4rem 0.8rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
  }

  .status-badge.online {
    background: rgba(0,255,157,0.15);
    color: #00ff9d;
  }

  .time {
    color: #64748b;
    font-family: monospace;
    font-size: 0.9rem;
  }

  .user-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: linear-gradient(135deg, #00d4ff, #00ff9d);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    color: black;
  }

  .content-area {
    flex: 1;
    padding: 2rem;
    overflow-y: auto;
  }

  .section-panel {
    display: none;
  }

  /* Stats Grid */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .stat-card {
    background: rgba(20,30,50,0.6);
    border: 1px solid #1f2937;
    border-radius: 16px;
    padding: 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .stat-icon { font-size: 2rem; }
  .stat-value { display: block; font-size: 1.8rem; font-weight: 800; color: #00d4ff; }
  .stat-label { color: #64748b; font-size: 0.85rem; }

  /* Quick Actions */
  .quick-actions, .modules-overview {
    background: rgba(20,30,50,0.6);
    border: 1px solid #1f2937;
    border-radius: 16px;
    padding: 1.5rem;
    margin-bottom: 2rem;
  }

  .quick-actions h3, .modules-overview h3 {
    color: white;
    margin: 0 0 1rem 0;
    font-size: 1.1rem;
  }

  .actions-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
  }

  .action-btn {
    background: rgba(0,212,255,0.1);
    border: 1px solid rgba(0,212,255,0.2);
    color: white;
    padding: 1rem;
    border-radius: 12px;
    cursor: pointer;
    transition: 0.2s;
    font-size: 0.95rem;
  }

  .action-btn:hover {
    background: rgba(0,212,255,0.2);
    border-color: #00d4ff;
    transform: translateY(-2px);
  }

  /* Modules Grid */
  .modules-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
  }

  .module-card {
    background: rgba(0,0,0,0.3);
    border: 1px solid #1f2937;
    border-radius: 12px;
    padding: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: 0.2s;
  }

  .module-card:hover {
    border-color: #374151;
  }

  .module-info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .module-info span:first-child {
    font-size: 1.5rem;
  }

  .module-name {
    color: white;
    font-weight: 600;
    font-size: 0.9rem;
  }

  /* Toggle Switch */
  .toggle-switch {
    position: relative;
    width: 50px;
    height: 26px;
  }

  .toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }

  .toggle-slider {
    position: absolute;
    cursor: pointer;
    inset: 0;
    background: #374151;
    border-radius: 26px;
    transition: 0.3s;
  }

  .toggle-slider::before {
    content: "";
    position: absolute;
    height: 20px;
    width: 20px;
    left: 3px;
    bottom: 3px;
    background: white;
    border-radius: 50%;
    transition: 0.3s;
  }

  input:checked + .toggle-slider {
    background: #00ff9d;
  }

  input:checked + .toggle-slider::before {
    transform: translateX(24px);
  }

  /* Tables */
  .table-container {
    background: rgba(20,30,50,0.6);
    border: 1px solid #1f2937;
    border-radius: 16px;
    overflow: hidden;
  }

  table { width: 100%; border-collapse: collapse; }

  th {
    text-align: left;
    padding: 1rem 1.5rem;
    background: rgba(0,0,0,0.3);
    color: #94a3b8;
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  td {
    padding: 1rem 1.5rem;
    color: white;
    border-top: 1px solid #1f2937;
  }

  tr:hover { background: rgba(0,212,255,0.05); }

  .loading {
    text-align: center;
    color: #64748b;
    padding: 3rem;
  }

  /* Section Header */
  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
  }

  .section-header h2 {
    color: white;
    margin: 0;
    font-size: 1.5rem;
  }

  .btn-primary {
    background: linear-gradient(135deg, #00d4ff, #00ff9d);
    color: black;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 10px;
    font-weight: 700;
    cursor: pointer;
    transition: 0.3s;
  }

  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 20px rgba(0,212,255,0.3);
  }

  /* Integration Cards */
  .integration-card {
    background: rgba(20,30,50,0.6);
    border: 1px solid #1f2937;
    border-radius: 16px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
  }

  .integration-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .integration-icon {
    width: 50px;
    height: 50px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    font-weight: 800;
    color: white;
  }

  .integration-header h3 {
    color: white;
    margin: 0;
    flex: 1;
  }

  .integration-status {
    font-size: 0.85rem;
    color: #64748b;
  }

  .integration-status.online { color: #00ff9d; }

  .integration-config {
    border-top: 1px solid #1f2937;
    padding-top: 1.5rem;
  }

  /* Forms */
  .config-form {
    background: rgba(20,30,50,0.6);
    border: 1px solid #1f2937;
    border-radius: 16px;
    padding: 2rem;
  }

  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
  }

  .form-group {
    margin-bottom: 1.5rem;
  }

  .form-group label {
    display: block;
    color: #94a3b8;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
  }

  .form-group input {
    width: 100%;
    padding: 0.75rem 1rem;
    background: rgba(0,0,0,0.3);
    border: 1px solid #334155;
    border-radius: 10px;
    color: white;
    font-size: 0.95rem;
  }

  .form-group input:focus {
    outline: none;
    border-color: #00d4ff;
  }

  /* Command Palette */
  .command-palette {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.8);
    backdrop-filter: blur(4px);
    display: flex;
    align-items: flex-start;
    justify-content: center;
    padding-top: 15vh;
    z-index: 1000;
  }

  .command-content {
    background: #0f172a;
    border: 1px solid #1f2937;
    border-radius: 16px;
    width: 100%;
    max-width: 600px;
    overflow: hidden;
  }

  .command-content input {
    width: 100%;
    padding: 1.25rem 1.5rem;
    background: transparent;
    border: none;
    border-bottom: 1px solid #1f2937;
    color: white;
    font-size: 1.1rem;
  }

  .command-content input:focus { outline: none; }

  .command-results {
    max-height: 400px;
    overflow-y: auto;
    padding: 1rem;
  }

  .command-group-title {
    display: block;
    color: #64748b;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    padding: 0.5rem;
  }

  .command-item {
    display: block;
    width: 100%;
    padding: 0.75rem 1rem;
    background: transparent;
    border: none;
    color: white;
    text-align: left;
    cursor: pointer;
    border-radius: 8px;
    transition: 0.2s;
  }

  .command-item:hover {
    background: rgba(0,212,255,0.1);
  }

  @media (max-width: 1200px) {
    .stats-grid, .actions-grid, .modules-grid { grid-template-columns: repeat(2, 1fr); }
  }

  @media (max-width: 768px) {
    .sidebar { transform: translateX(-100%); }
    .sidebar.open { transform: translateX(0); }
    .main-content { margin-left: 0; }
    .stats-grid, .actions-grid { grid-template-columns: 1fr; }
  }

  /* Schedule Grid */
  .schedule-grid { display: flex; flex-direction: column; gap: 1rem; }
  .schedule-day {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: rgba(0,0,0,0.2);
    border-radius: 10px;
  }
  .day-name { color: white; font-weight: 600; width: 100px; }
  .time-input {
    padding: 0.5rem;
    background: rgba(0,0,0,0.3);
    border: 1px solid #334155;
    border-radius: 6px;
    color: white;
  }

  /* Backup Cards */
  .backup-cards { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; }
  .backup-card {
    background: rgba(20,30,50,0.6);
    border: 1px solid #1f2937;
    border-radius: 16px;
    padding: 1.5rem;
  }
  .backup-card h3 { color: white; margin: 0; font-size: 1.1rem; }

  /* Playground */
  .playground-container {
    background: rgba(20,30,50,0.6);
    border: 1px solid #1f2937;
    border-radius: 16px;
    overflow: hidden;
  }
  .playground-chat {
    height: 400px;
    overflow-y: auto;
    padding: 1.5rem;
  }
  .chat-message {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
  }
  .chat-message .avatar {
    font-size: 1.5rem;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #1e293b;
    border-radius: 50%;
  }
  .message-content {
    background: #1e293b;
    padding: 1rem;
    border-radius: 12px;
    color: white;
    max-width: 70%;
  }
  .chat-message.user { flex-direction: row-reverse; }
  .chat-message.user .message-content { background: #00d4ff20; }
  .playground-input {
    display: flex;
    gap: 1rem;
    padding: 1rem;
    border-top: 1px solid #1f2937;
  }
  .playground-input input {
    flex: 1;
    padding: 0.75rem 1rem;
    background: rgba(0,0,0,0.3);
    border: 1px solid #334155;
    border-radius: 10px;
    color: white;
  }

  /* Buttons */
  .btn-secondary {
    background: #1f2937;
    color: white;
    border: 1px solid #374151;
    padding: 0.75rem 1.5rem;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
  }
  .btn-sm {
    background: #1f2937;
    color: white;
    border: none;
    padding: 0.4rem 0.8rem;
    border-radius: 6px;
    font-size: 0.85rem;
    cursor: pointer;
  }
  .btn-sm:hover { background: #374151; }

  .integrations-list {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
  }

  /* Modals */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.85);
    backdrop-filter: blur(4px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    padding: 2rem;
  }

  .modal-content {
    background: #0f172a;
    border: 1px solid #1f2937;
    border-radius: 20px;
    width: 100%;
    max-width: 550px;
    max-height: 90vh;
    overflow-y: auto;
    animation: modalIn 0.2s ease;
  }

  .modal-content.modal-lg { max-width: 750px; }
  .modal-content.modal-sm { max-width: 400px; }

  @keyframes modalIn {
    from { opacity: 0; transform: scale(0.95) translateY(-10px); }
    to { opacity: 1; transform: scale(1) translateY(0); }
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem 2rem;
    border-bottom: 1px solid #1f2937;
  }

  .modal-header h2 {
    color: white;
    margin: 0;
    font-size: 1.3rem;
  }

  .modal-close {
    background: transparent;
    border: none;
    color: #64748b;
    font-size: 1.8rem;
    cursor: pointer;
    line-height: 1;
  }

  .modal-close:hover { color: white; }

  .modal-content form {
    padding: 1.5rem 2rem 2rem;
  }

  .modal-content select,
  .modal-content textarea {
    width: 100%;
    padding: 0.75rem 1rem;
    background: rgba(0,0,0,0.3);
    border: 1px solid #334155;
    border-radius: 10px;
    color: white;
    font-size: 0.95rem;
  }

  .modal-content textarea { resize: vertical; font-family: inherit; }

  .modal-actions {
    display: flex;
    justify-content: flex-end;
    gap: 1rem;
    padding-top: 1rem;
    border-top: 1px solid #1f2937;
    margin-top: 1.5rem;
  }

  .btn-outline {
    background: transparent;
    color: #00d4ff;
    border: 1px solid #00d4ff;
    padding: 0.75rem 1.5rem;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
  }

  .btn-danger {
    background: #ef4444;
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
  }

  /* Checkbox Grid */
  .checkbox-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.75rem;
  }

  .checkbox-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #94a3b8;
    font-size: 0.9rem;
    cursor: pointer;
  }

  .checkbox-item input { accent-color: #00d4ff; }

  /* Toast */
  .toast-container {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    z-index: 2000;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .toast {
    background: #1e293b;
    border: 1px solid #334155;
    border-radius: 12px;
    padding: 1rem 1.5rem;
    color: white;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    animation: toastIn 0.3s ease;
    box-shadow: 0 10px 40px rgba(0,0,0,0.5);
  }

  .toast.success { border-color: #00ff9d; }
  .toast.error { border-color: #ef4444; }
  .toast.warning { border-color: #f59e0b; }

  @keyframes toastIn {
    from { opacity: 0; transform: translateX(100%); }
    to { opacity: 1; transform: translateX(0); }
  }

  .toast-icon { font-size: 1.3rem; }
</style>

<script is:inline>
  const API_URL = window.location.hostname === 'localhost' 
    ? 'http://localhost:8080' 
    : 'https://api.getnexo.com.br';

  // Clock
  function updateClock() {
    const now = new Date();
    document.getElementById('clock').textContent = now.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
  }
  setInterval(updateClock, 1000);
  updateClock();

  // Sidebar Toggle
  document.getElementById('toggle-sidebar').addEventListener('click', () => {
    document.getElementById('sidebar').classList.toggle('collapsed');
  });

  // Submenu Toggle
  document.querySelectorAll('.nav-group-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const targetId = btn.getAttribute('data-target');
      const submenu = document.getElementById(targetId);
      const isOpen = submenu.classList.contains('open');
      
      // Close all submenus
      document.querySelectorAll('.nav-submenu').forEach(m => m.classList.remove('open'));
      document.querySelectorAll('.nav-group-btn').forEach(b => b.setAttribute('aria-expanded', 'false'));
      
      if (!isOpen) {
        submenu.classList.add('open');
        btn.setAttribute('aria-expanded', 'true');
      }
    });
  });

  // Section Navigation
  document.querySelectorAll('.nav-subitem[data-section]').forEach(item => {
    item.addEventListener('click', (e) => {
      e.preventDefault();
      const section = item.getAttribute('data-section');
      showSection(section);
    });
  });

  window.showSection = function(sectionId) {
    // Hide all sections
    document.querySelectorAll('.section-panel').forEach(s => s.style.display = 'none');
    
    // Show target section
    const target = document.getElementById(`section-${sectionId}`);
    if (target) {
      target.style.display = 'block';
      
      // Update header
      const titles = {
        'dashboard': 'Dashboard',
        'produtos': 'Produtos',
        'cupons': 'Cupons de Desconto',
        'campanhas': 'Campanhas de Broadcast',
        'ia-provedores': 'Provedores de IA',
        'int-whatsapp': 'IntegraÃ§Ã£o WhatsApp',
        'int-crm': 'IntegraÃ§Ãµes CRM',
        'int-pagamentos': 'IntegraÃ§Ãµes de Pagamento',
        'cfg-empresa': 'Dados da Empresa'
      };
      document.getElementById('section-title').textContent = titles[sectionId] || sectionId;
      
      // Mark active submenu item
      document.querySelectorAll('.nav-subitem').forEach(i => i.classList.remove('active'));
      document.querySelector(`.nav-subitem[data-section="${sectionId}"]`)?.classList.add('active');
      
      // Load data if needed
      loadSectionData(sectionId);
    }
  };

  // Load Section Data
  async function loadSectionData(section) {
    switch(section) {
      case 'produtos':
        loadProducts();
        break;
      case 'cupons':
        loadCoupons();
        break;
      case 'ia-provedores':
        loadProviders();
        break;
      case 'int-crm':
        loadCRMIntegrations();
        break;
      case 'int-pagamentos':
        loadPaymentIntegrations();
        break;
    }
  }

  // Load Products
  async function loadProducts() {
    try {
      const res = await fetch(`${API_URL}/api/products`);
      const products = await res.json();
      const tbody = document.getElementById('produtos-tbody');
      
      if (!products.length) {
        tbody.innerHTML = '<tr><td colspan="5" class="loading">Nenhum produto cadastrado</td></tr>';
        return;
      }
      
      tbody.innerHTML = products.map(p => `
        <tr>
          <td>
            <div style="display:flex; align-items:center; gap:0.8rem;">
              <div style="width:40px; height:40px; background:#1e293b; border-radius:6px; display:flex; align-items:center; justify-content:center;">${p.image_url ? `<img src="${p.image_url}" style="width:100%; height:100%; object-fit:cover; border-radius:6px;">` : 'ğŸ“¦'}</div>
              <div>
                <div style="font-weight:600;">${p.name}</div>
                <div style="font-size:0.8rem; color:#64748b;">${p.sku || 'S/ SKU'}</div>
              </div>
            </div>
          </td>
          <td>
            <div>R$ ${p.price?.toFixed(2) || '0.00'}</div>
            ${p.promo_price ? `<div style="font-size:0.8rem; color:#10b981; text-decoration:line-through;">R$ ${p.promo_price.toFixed(2)}</div>` : ''}
          </td>
          <td>
            <div style="display:flex; align-items:center; gap:0.5rem;">
              <span>${p.stock || 0}</span>
              ${(p.stock || 0) < 10 ? '<span style="color:#f59e0b; font-size:0.8rem;">âš ï¸</span>' : ''}
            </div>
          </td>
          <td><span class="status-badge ${p.active ? 'online' : ''}">${p.active ? 'Ativo' : 'Inativo'}</span></td>
          <td>
            <button class="btn-sm" onclick="openModal('produto', ${JSON.stringify(p).replace(/"/g, '&quot;')})">âœï¸</button>
            <button class="btn-sm" onclick="toggleProduct(${p.id})">ğŸ”„</button>
          </td>
        </tr>
      `).join('');
    } catch (e) {
      console.error('Error loading products:', e);
    }
  }

  // Load Pedidos
  async function loadPedidos() {
    try {
      // Mock data for demo
      const orders = [
        { id: '#PED-1024', client: 'JoÃ£o Silva', items: '2x Camiseta, 1x BonÃ©', total: 199.90, status: 'paid', date: 'Hoje, 10:30' },
        { id: '#PED-1023', client: 'Maria Oliveira', items: '1x TÃªnis Run', total: 299.90, status: 'pending', date: 'Ontem, 16:45' },
        { id: '#PED-1022', client: 'Carlos Santos', items: '3x Meia Sport', total: 49.90, status: 'shipped', date: '15/01/2026' }
      ];
      
      const statusMap = {
        pending: { label: 'Pendente', class: 'warning' },
        paid: { label: 'Pago', class: 'online' },
        shipped: { label: 'Enviado', class: 'info' },
        delivered: { label: 'Entregue', class: 'online' },
        cancelled: { label: 'Cancelado', class: 'error' }
      };

      const tbody = document.getElementById('pedidos-tbody');
      tbody.innerHTML = orders.map(o => `
        <tr>
          <td><code>${o.id}</code></td>
          <td>${o.client}</td>
          <td>${o.items}</td>
          <td>R$ ${o.total.toFixed(2)}</td>
          <td><span class="status-badge ${statusMap[o.status].class}">${statusMap[o.status].label}</span></td>
          <td>${o.date}</td>
          <td><button class="btn-sm">ğŸ‘ï¸ Ver</button></td>
        </tr>
      `).join('');
    } catch (e) { console.error(e); }
  }

  // Load Categorias
  async function loadCategorias() {
    // Mock
    const categories = [
      { id: 1, name: 'Roupas', slug: 'roupas', count: 145, active: true },
      { id: 2, name: 'CalÃ§ados', slug: 'calcados', count: 89, active: true },
      { id: 3, name: 'AcessÃ³rios', slug: 'acessorios', count: 213, active: true }
    ];
    
    document.getElementById('categories-grid').innerHTML = categories.map(c => `
      <div class="module-card">
        <div class="module-info">
          <span>ğŸ“‚</span>
          <div>
            <div class="module-name">${c.name}</div>
            <div style="font-size:0.8rem; color:#64748b;">/${c.slug} â€¢ ${c.count} itens</div>
          </div>
        </div>
        <div style="display:flex; gap:0.5rem;">
          <button class="btn-sm" onclick="openModal('categoria', ${JSON.stringify(c).replace(/"/g, '&quot;')})">âœï¸</button>
          <label class="toggle-switch">
            <input type="checkbox" ${c.active ? 'checked' : ''} />
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
    `).join('');
  }

  // Load Estoque
  async function loadEstoque() {
    // Mock
    const stock = [
      { product: 'Camiseta Basic Branca', sku: 'CAM-001', qty: 145, min: 20 },
      { product: 'BonÃ© Trucker Preto', sku: 'BON-002', qty: 5, min: 10 },
      { product: 'Meia Cano Alto', sku: 'MEI-003', qty: 0, min: 50 },
    ];
    
    document.getElementById('estoque-total').textContent = '2.4k';
    document.getElementById('estoque-baixo').textContent = '12';
    document.getElementById('estoque-zerado').textContent = '3';
    
    document.getElementById('estoque-tbody').innerHTML = stock.map(s => `
      <tr>
        <td>${s.product}</td>
        <td><code>${s.sku}</code></td>
        <td>
          <span style="color:${s.qty === 0 ? '#ef4444' : s.qty < s.min ? '#f59e0b' : 'white'}">${s.qty}</span>
        </td>
        <td>${s.min}</td>
        <td>
          ${s.qty === 0 ? '<span class="status-badge error">Zerado</span>' : 
            s.qty < s.min ? '<span class="status-badge warning">Baixo</span>' : 
            '<span class="status-badge online">OK</span>'}
        </td>
        <td><button class="btn-sm">ğŸ“ Ajustar</button></td>
      </tr>
    `).join('');
  }

  // Load Filas
  function loadFilas() {
    // Mock logic handled in HTML for now, would fetch from API
  }

  // Load SessÃµes
  function loadSessoes() {
    // Mock logic handled in HTML
  }

  // Load Bloqueios
  function loadBloqueios() {
    // Mock
    const blocked = [
      { ip: '45.174.xxx.xxx', reason: 'Ataque DDoS', by: 'System', date: '15/01/2026' }
    ];
    const tbody = document.getElementById('blocked-ips-tbody');
    if (blocked.length) {
      tbody.innerHTML = blocked.map(b => `
        <tr>
          <td><code>${b.ip}</code></td>
          <td>${b.reason}</td>
          <td>${b.by}</td>
          <td>${b.date}</td>
          <td><button class="btn-sm" style="color:#ef4444;">Desbloquear</button></td>
        </tr>
      `).join('');
    }
  }
  
  // Load Bot Config
  function loadBotConfig() {
    // Load config logic
  }

  // Load RelatÃ³rios Charts
  function loadRelatorios() {
    if (document.getElementById('chart-vendas')) {
      // Mock Data
      document.getElementById('rel-total-vendas').textContent = 'R$ 45.230,00';
      document.getElementById('rel-qtd-pedidos').textContent = '342';
      document.getElementById('rel-ticket-medio').textContent = 'R$ 132,25';
      document.getElementById('rel-taxa-conversao').textContent = '2.4%';

      // Chart.js would need to be loaded via script tag in head or import
      // Assuming available or using simple CSS bars for now if no lib
      // Just placeholder for logic
    }
  }

  // Save Functions
  window.saveBotConfig = function() {
    showToast('ConfiguraÃ§Ãµes do bot salvas!', 'success');
  };

  window.saveCategoria = function(e) {
    e.preventDefault();
    showToast('Categoria salva!', 'success');
    closeModal('categoria');
  };

  window.saveFila = function(e) {
    e.preventDefault();
    showToast('Fila salva!', 'success');
    closeModal('fila');
  };

  window.saveBloqueioIP = function(e) {
    e.preventDefault();
    showToast('IP bloqueado com sucesso!', 'error');
    closeModal('bloqueio-ip');
  };
  
  window.saveNotifications = function() {
    showToast('PreferÃªncias de notificaÃ§Ã£o atualizadas!', 'success');
  };

  window.revokeAllSessions = function() {
    if(confirm('Tem certeza? Isso desconectarÃ¡ todos os usuÃ¡rios.')) {
      showToast('Todas as sessÃµes foram encerradas.', 'warning');
      setTimeout(() => window.location.reload(), 1000);
    }
  };

  window.clearIAHistory = function() {
    if(confirm('Apagar todo o histÃ³rico de conversas da IA?')) {
      document.getElementById('ia-history-tbody').innerHTML = '<tr><td colspan="5" class="loading">HistÃ³rico vazio</td></tr>';
      showToast('HistÃ³rico apagado.', 'success');
    }
  };

  // Export Functions
  window.exportPedidos = () => showToast('Exportando pedidos (CSV)...', 'info');
  window.exportEstoque = () => showToast('Exportando relatÃ³rio de estoque...', 'info');
  window.exportRelVendas = () => showToast('Exportando relatÃ³rio de vendas...', 'info');
  window.exportRelLeads = () => showToast('Exportando leads...', 'info');
  window.exportRelAtendimento = () => showToast('Exportando mÃ©tricas de atendimento...', 'info');
  
  window.exportData = (type) => {
    showToast(`Iniciando exportaÃ§Ã£o de ${type}...`, 'info');
    setTimeout(() => showToast('Download iniciado!', 'success'), 1500);
  };

  // Switch Section Extension
  const originalShowSection = window.showSection;
  window.showSection = function(sectionId) {
    // Call original logic (which just manages display:none)
    document.querySelectorAll('.section-panel').forEach(el => el.style.display = 'none');
    document.getElementById('intro-panel').style.display = 'none';
    
    // Map IDs if needed (e.g. 'produtos' -> 'section-produtos')
    const realId = sectionId.startsWith('section-') ? sectionId : `section-${sectionId}`;
    const target = document.getElementById(realId);
    
    if (target) {
      target.style.display = 'block';
      
      // Lazy load data based on section
      if(sectionId === 'produtos') loadProducts();
      if(sectionId === 'pedidos') loadPedidos();
      if(sectionId === 'categorias') loadCategorias();
      if(sectionId === 'estoque') loadEstoque();
      if(sectionId === 'filas') loadFilas();
      if(sectionId === 'seg-ips') loadBloqueios();
      if(sectionId === 'rel-vendas') loadRelatorios();
      if(sectionId === 'ia-provedores') loadProviders();
      // ... mappings for all sections
    }
  };


  // Load Coupons
  async function loadCoupons() {
    try {
      const res = await fetch(`${API_URL}/api/coupons`);
      const coupons = await res.json();
      const tbody = document.getElementById('cupons-tbody');
      
      if (!coupons.length) {
        tbody.innerHTML = '<tr><td colspan="6" class="loading">Nenhum cupom cadastrado</td></tr>';
        return;
      }
      
      tbody.innerHTML = coupons.map(c => `
        <tr>
          <td><code>${c.code}</code></td>
          <td>${c.discount}%</td>
          <td>${c.expires_at ? new Date(c.expires_at).toLocaleDateString('pt-BR') : 'Sem validade'}</td>
          <td>${c.uses || 0}/${c.max_uses || 'âˆ'}</td>
          <td>
            <label class="toggle-switch">
              <input type="checkbox" ${c.active ? 'checked' : ''} onchange="toggleCoupon('${c.id}', this.checked)" />
              <span class="toggle-slider"></span>
            </label>
          </td>
          <td>
            <button onclick="editCoupon('${c.id}')">âœï¸</button>
            <button onclick="deleteCoupon('${c.id}')">ğŸ—‘ï¸</button>
          </td>
        </tr>
      `).join('');
    } catch (e) {
      console.error('Error loading coupons:', e);
    }
  }

  // Load IA Providers
  function loadProviders() {
    const providers = [
      { id: 'gemini', name: 'Google Gemini', icon: 'ğŸ’', enabled: true },
      { id: 'openrouter', name: 'OpenRouter', icon: 'ğŸŒ', enabled: false },
      { id: 'grok', name: 'xAI Grok', icon: 'ğŸ¤–', enabled: false },
      { id: 'deepseek', name: 'DeepSeek', icon: 'ğŸ”¬', enabled: false },
      { id: 'openai', name: 'OpenAI', icon: 'ğŸ§ ', enabled: false }
    ];
    
    const grid = document.getElementById('providers-grid');
    grid.innerHTML = providers.map(p => `
      <div class="integration-card">
        <div class="integration-header">
          <span class="integration-icon" style="background:#1f2937;">${p.icon}</span>
          <div style="flex:1;">
            <h3 style="color:white; margin:0;">${p.name}</h3>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" ${p.enabled ? 'checked' : ''} onchange="toggleProvider('${p.id}', this.checked)" />
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="form-group">
          <label>API Key</label>
          <input type="password" id="${p.id}-key" placeholder="Cole sua API Key aqui" />
        </div>
        <button class="btn-primary" onclick="saveProvider('${p.id}')">Salvar</button>
      </div>
    `).join('');
  }

  // Load CRM Integrations
  function loadCRMIntegrations() {
    const integrations = [
      { id: 'hubspot', name: 'HubSpot', enabled: true },
      { id: 'rdstation', name: 'RD Station', enabled: false },
      { id: 'pipedrive', name: 'Pipedrive', enabled: false },
      { id: 'salesforce', name: 'Salesforce', enabled: false }
    ];
    
    renderIntegrationsList('crm-integrations', integrations);
  }

  // Load Payment Integrations
  function loadPaymentIntegrations() {
    const integrations = [
      { id: 'mercadopago', name: 'Mercado Pago', enabled: true },
      { id: 'stripe', name: 'Stripe', enabled: false },
      { id: 'pagseguro', name: 'PagSeguro', enabled: false },
      { id: 'asaas', name: 'Asaas', enabled: false },
      { id: 'pix', name: 'PIX Direto', enabled: true }
    ];
    
    renderIntegrationsList('payment-integrations', integrations);
  }

  function renderIntegrationsList(containerId, integrations) {
    const container = document.getElementById(containerId);
    container.innerHTML = integrations.map(int => `
      <div class="module-card">
        <div class="module-info">
          <span>ğŸ”—</span>
          <span class="module-name">${int.name}</span>
        </div>
        <label class="toggle-switch">
          <input type="checkbox" ${int.enabled ? 'checked' : ''} onchange="toggleIntegration('${int.id}', this.checked)" />
          <span class="toggle-slider"></span>
        </label>
      </div>
    `).join('');
  }

  // Load Dashboard Stats
  async function loadDashboardStats() {
    try {
      const res = await fetch(`${API_URL}/api/relatorio`);
      const data = await res.json();
      
      document.getElementById('stat-vendas').textContent = 'R$ ' + (data.totalVendas || 0).toLocaleString('pt-BR', { minimumFractionDigits: 2 });
      document.getElementById('stat-pedidos').textContent = data.pedidos || 0;
      document.getElementById('stat-conversas').textContent = data.conversas || 0;
      document.getElementById('stat-leads').textContent = data.leads || 0;
    } catch (e) {
      console.error('Error loading dashboard stats:', e);
    }
  }

  // Load Modules Overview
  function loadModulesOverview() {
    const modules = [
      { id: 'whatsapp', name: 'WhatsApp Bot', icon: 'ğŸ“±', enabled: true },
      { id: 'ia', name: 'IA Vendedora', icon: 'ğŸ¤–', enabled: true },
      { id: 'campanhas', name: 'Campanhas', icon: 'ğŸ“¢', enabled: true },
      { id: 'carrinho', name: 'Carrinho Abandonado', icon: 'ğŸ›’', enabled: true },
      { id: 'loja', name: 'Loja Virtual', icon: 'ğŸª', enabled: true },
      { id: 'leads', name: 'Captura de Leads', icon: 'ğŸ‘¥', enabled: true },
      { id: 'relatorios', name: 'RelatÃ³rios', icon: 'ğŸ“Š', enabled: true },
      { id: 'notificacoes', name: 'NotificaÃ§Ãµes', icon: 'ğŸ””', enabled: false }
    ];
    
    const grid = document.getElementById('modules-grid');
    grid.innerHTML = modules.map(m => `
      <div class="module-card">
        <div class="module-info">
          <span>${m.icon}</span>
          <span class="module-name">${m.name}</span>
        </div>
        <label class="toggle-switch">
          <input type="checkbox" ${m.enabled ? 'checked' : ''} onchange="toggleModule('${m.id}', this.checked)" />
          <span class="toggle-slider"></span>
        </label>
      </div>
    `).join('');
  }

  // Command Palette
  document.addEventListener('keydown', (e) => {
    if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
      e.preventDefault();
      const palette = document.getElementById('command-palette');
      palette.style.display = palette.style.display === 'none' ? 'flex' : 'none';
      if (palette.style.display === 'flex') {
        document.getElementById('command-input').focus();
      }
    }
    if (e.key === 'Escape') {
      document.getElementById('command-palette').style.display = 'none';
    }
  });

  document.querySelectorAll('.command-item').forEach(item => {
    item.addEventListener('click', () => {
      const action = item.getAttribute('data-action');
      showSection(action);
      document.getElementById('command-palette').style.display = 'none';
    });
  });

  // Logout
  window.logout = function() {
    localStorage.removeItem('omnichat_token');
    localStorage.removeItem('adminUser');
    window.location.href = '/admin/login';
  };

  // Check Auth
  function checkAuth() {
    const token = localStorage.getItem('omnichat_token');
    if (!token) {
      window.location.href = '/admin/login';
      return false;
    }
    
    const user = JSON.parse(localStorage.getItem('adminUser') || '{}');
    if (user.name) {
      document.getElementById('user-avatar').textContent = user.name.charAt(0).toUpperCase();
    }
    return true;
  }

  // Global toggle functions
  window.toggleModule = async function(id, enabled) {
    try {
      await fetch(`${ROLES_API}/api/modules/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${getToken()}` },
        body: JSON.stringify({ enabled })
      });
      showToast(`MÃ³dulo ${enabled ? 'ativado' : 'desativado'}`, 'success');
    } catch (e) {
      showToast('Erro ao alterar mÃ³dulo', 'error');
    }
  };

  window.toggleIntegration = async function(id, enabled) {
    try {
      await fetch(`${ROLES_API}/api/integrations/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${getToken()}` },
        body: JSON.stringify({ enabled })
      });
      showToast(`IntegraÃ§Ã£o ${enabled ? 'ativada' : 'desativada'}`, 'success');
    } catch (e) {
      showToast('Erro ao alterar integraÃ§Ã£o', 'error');
    }
  };

  window.toggleProvider = async function(id, enabled) {
    try {
      await fetch(`${ROLES_API}/api/ai-providers/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${getToken()}` },
        body: JSON.stringify({ enabled })
      });
      showToast(`Provedor IA ${enabled ? 'ativado' : 'desativado'}`, 'success');
    } catch (e) {
      showToast('Erro ao alterar provedor', 'error');
    }
  };

  window.toggleCoupon = async function(id, enabled) {
    try {
      await fetch(`${API_URL}/api/coupons/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ active: enabled })
      });
      showToast(`Cupom ${enabled ? 'ativado' : 'desativado'}`, 'success');
    } catch (e) {
      showToast('Erro ao alterar cupom', 'error');
    }
  };

  // Modal Functions
  window.openModal = function(type, data = null) {
    const modal = document.getElementById(`modal-${type}`);
    if (!modal) return;
    
    const titleEl = document.getElementById(`modal-${type}-title`);
    if (titleEl) {
      titleEl.textContent = data ? `Editar ${type.charAt(0).toUpperCase() + type.slice(1)}` : `Novo ${type.charAt(0).toUpperCase() + type.slice(1)}`;
    }
    
    // Reset form
    const form = modal.querySelector('form');
    if (form) form.reset();
    
    // Populate if editing
    if (data) {
      Object.keys(data).forEach(key => {
        const input = document.getElementById(`${type}-${key}`);
        if (input) input.value = data[key];
      });
    }
    
    modal.style.display = 'flex';
  };

  window.closeModal = function(type) {
    const modal = document.getElementById(`modal-${type}`);
    if (modal) modal.style.display = 'none';
  };

  // Close modal on overlay click
  document.querySelectorAll('.modal-overlay').forEach(overlay => {
    overlay.addEventListener('click', (e) => {
      if (e.target === overlay) {
        overlay.style.display = 'none';
      }
    });
  });

  // Toast Notifications
  window.showToast = function(message, type = 'success') {
    const container = document.getElementById('toast-container');
    const icons = { success: 'âœ…', error: 'âŒ', warning: 'âš ï¸', info: 'â„¹ï¸' };
    
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.innerHTML = `<span class="toast-icon">${icons[type] || icons.info}</span><span>${message}</span>`;
    
    container.appendChild(toast);
    
    setTimeout(() => {
      toast.style.animation = 'toastIn 0.3s ease reverse';
      setTimeout(() => toast.remove(), 300);
    }, 3000);
  };

  // Save Functions
  window.saveProduto = async function(e) {
    e.preventDefault();
    const data = {
      name: document.getElementById('produto-nome').value,
      sku: document.getElementById('produto-sku').value,
      price: parseFloat(document.getElementById('produto-preco').value),
      promo_price: parseFloat(document.getElementById('produto-preco-promo').value) || null,
      stock: parseInt(document.getElementById('produto-estoque').value) || null,
      category: document.getElementById('produto-categoria').value,
      description: document.getElementById('produto-descricao').value,
      image_url: document.getElementById('produto-imagem').value,
      active: document.getElementById('produto-ativo').checked
    };
    
    const id = document.getElementById('produto-id').value;
    try {
      await fetch(`${API_URL}/api/products${id ? `/${id}` : ''}`, {
        method: id ? 'PUT' : 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      showToast('Produto salvo com sucesso!', 'success');
      closeModal('produto');
      loadProducts();
    } catch (e) {
      showToast('Erro ao salvar produto', 'error');
    }
  };

  window.saveCupom = async function(e) {
    e.preventDefault();
    const data = {
      code: document.getElementById('cupom-codigo').value.toUpperCase(),
      type: document.getElementById('cupom-tipo').value,
      value: parseFloat(document.getElementById('cupom-valor').value),
      min_order: parseFloat(document.getElementById('cupom-minimo').value) || null,
      expires_at: document.getElementById('cupom-expira').value || null,
      max_uses: parseInt(document.getElementById('cupom-limite').value) || null,
      description: document.getElementById('cupom-descricao').value,
      active: document.getElementById('cupom-ativo').checked
    };
    
    const id = document.getElementById('cupom-id').value;
    try {
      await fetch(`${API_URL}/api/coupons${id ? `/${id}` : ''}`, {
        method: id ? 'PUT' : 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      showToast('Cupom salvo com sucesso!', 'success');
      closeModal('cupom');
      loadCoupons();
    } catch (e) {
      showToast('Erro ao salvar cupom', 'error');
    }
  };

  window.saveMacro = async function(e) {
    e.preventDefault();
    const data = {
      shortcut: document.getElementById('macro-atalho').value,
      title: document.getElementById('macro-titulo').value,
      content: document.getElementById('macro-conteudo').value,
      category: document.getElementById('macro-categoria').value,
      active: document.getElementById('macro-ativo').checked
    };
    
    const id = document.getElementById('macro-id').value;
    try {
      await fetch(`${API_URL}/api/macros${id ? `/${id}` : ''}`, {
        method: id ? 'PUT' : 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      showToast('Macro salva com sucesso!', 'success');
      closeModal('macro');
      loadMacros();
    } catch (e) {
      showToast('Erro ao salvar macro', 'error');
    }
  };

  window.saveCampanha = async function(e) {
    e.preventDefault();
    const data = {
      name: document.getElementById('campanha-nome').value,
      type: document.getElementById('campanha-tipo').value,
      message: document.getElementById('campanha-mensagem').value,
      segment: Array.from(document.getElementById('campanha-segmento').selectedOptions).map(o => o.value),
      scheduled_at: document.getElementById('campanha-agenda').value || null,
      attachment: document.getElementById('campanha-anexo').value || null
    };
    
    try {
      await fetch(`${API_URL}/api/campaigns`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      showToast('Campanha criada com sucesso!', 'success');
      closeModal('campanha');
    } catch (e) {
      showToast('Erro ao criar campanha', 'error');
    }
  };

  window.saveWebhook = async function(e) {
    e.preventDefault();
    const events = Array.from(document.querySelectorAll('#form-webhook .checkbox-item input:checked')).map(i => i.value);
    const data = {
      name: document.getElementById('webhook-nome').value,
      url: document.getElementById('webhook-url').value,
      events,
      headers: document.getElementById('webhook-headers').value,
      active: document.getElementById('webhook-ativo').checked
    };
    
    const id = document.getElementById('webhook-id').value;
    try {
      await fetch(`${API_URL}/api/webhooks${id ? `/${id}` : ''}`, {
        method: id ? 'PUT' : 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      showToast('Webhook salvo com sucesso!', 'success');
      closeModal('webhook');
    } catch (e) {
      showToast('Erro ao salvar webhook', 'error');
    }
  };

  window.testWebhook = async function() {
    const url = document.getElementById('webhook-url').value;
    if (!url) {
      showToast('Informe a URL do webhook', 'warning');
      return;
    }
    showToast('Enviando teste...', 'info');
    try {
      await fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ test: true, timestamp: new Date().toISOString() })
      });
      showToast('Webhook testado!', 'success');
    } catch (e) {
      showToast('Erro ao testar webhook', 'error');
    }
  };

  // Save AI Config
  window.saveAIPrompts = async function() {
    const data = {
      name: document.getElementById('ai-name').value,
      personality: document.getElementById('ai-personality').value,
      context: document.getElementById('ai-context').value,
      company_info: document.getElementById('ai-company-info').value
    };
    try {
      await fetch(`${ROLES_API}/api/settings/ai/prompts`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${getToken()}` },
        body: JSON.stringify({ value: data })
      });
      showToast('ConfiguraÃ§Ãµes de IA salvas!', 'success');
    } catch (e) {
      showToast('Erro ao salvar', 'error');
    }
  };

  // Save Schedule
  window.saveSchedule = async function() {
    const schedule = {};
    document.querySelectorAll('.schedule-day').forEach(day => {
      const checkbox = day.querySelector('input[type="checkbox"]');
      const times = day.querySelectorAll('input[type="time"]');
      const dayName = checkbox.dataset.day;
      if (dayName) {
        schedule[dayName] = {
          enabled: checkbox.checked,
          start: times[0]?.value,
          end: times[1]?.value
        };
      }
    });
    schedule.offline_message = document.getElementById('offline-message').value;
    
    try {
      await fetch(`${ROLES_API}/api/settings/atendimento/horarios`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${getToken()}` },
        body: JSON.stringify({ value: schedule })
      });
      showToast('HorÃ¡rios salvos!', 'success');
    } catch (e) {
      showToast('Erro ao salvar horÃ¡rios', 'error');
    }
  };

  // Test AI
  window.testAI = async function() {
    const input = document.getElementById('playground-input');
    const chat = document.getElementById('playground-chat');
    const message = input.value.trim();
    if (!message) return;
    
    // Add user message
    chat.innerHTML += `<div class="chat-message user"><span class="avatar">ğŸ‘¤</span><div class="message-content">${message}</div></div>`;
    input.value = '';
    chat.scrollTop = chat.scrollHeight;
    
    try {
      const res = await fetch(`${API_URL}/api/chat`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message, test: true })
      });
      const data = await res.json();
      chat.innerHTML += `<div class="chat-message bot"><span class="avatar">ğŸ¤–</span><div class="message-content">${data.reply || 'Sem resposta'}</div></div>`;
    } catch (e) {
      chat.innerHTML += `<div class="chat-message bot"><span class="avatar">ğŸ¤–</span><div class="message-content">Erro ao conectar com IA</div></div>`;
    }
    chat.scrollTop = chat.scrollHeight;
  };

  // Playground enter key
  document.getElementById('playground-input')?.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') testAI();
  });

  // Backup
  window.exportBackup = async function() {
    showToast('Gerando backup...', 'info');
    const format = document.getElementById('export-format').value;
    try {
      const res = await fetch(`${ROLES_API}/api/backup?format=${format}`, {
        headers: { 'Authorization': `Bearer ${getToken()}` }
      });
      const blob = await res.blob();
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `backup_getnexo_${new Date().toISOString().split('T')[0]}.${format}`;
      a.click();
      document.getElementById('last-backup-date').textContent = new Date().toLocaleString('pt-BR');
      showToast('Backup gerado!', 'success');
    } catch (e) {
      showToast('Erro ao gerar backup', 'error');
    }
  };

  // E-commerce & Automation Integrations
  function loadEcommerceIntegrations() {
    const integrations = [
      { id: 'shopify', name: 'Shopify', enabled: false },
      { id: 'woocommerce', name: 'WooCommerce', enabled: false },
      { id: 'nuvemshop', name: 'Nuvemshop', enabled: false },
      { id: 'yampi', name: 'Yampi', enabled: false },
      { id: 'tray', name: 'Tray', enabled: false },
      { id: 'vtex', name: 'VTEX', enabled: false }
    ];
    renderIntegrationsList('ecommerce-integrations', integrations);
  }

  function loadAutomationIntegrations() {
    const integrations = [
      { id: 'n8n', name: 'n8n', enabled: true },
      { id: 'make', name: 'Make (Integromat)', enabled: false },
      { id: 'zapier', name: 'Zapier', enabled: false },
      { id: 'pabbly', name: 'Pabbly Connect', enabled: false }
    ];
    renderIntegrationsList('automation-integrations', integrations);
  }

  // Load Macros
  async function loadMacros() {
    try {
      const res = await fetch(`${API_URL}/macros`);
      const macros = await res.json();
      const tbody = document.getElementById('macros-tbody');
      if (!macros.length) {
        tbody.innerHTML = '<tr><td colspan="5" class="loading">Nenhuma macro cadastrada</td></tr>';
        return;
      }
      tbody.innerHTML = macros.map(m => `
        <tr>
          <td><code>${m.shortcut}</code></td>
          <td>${m.title}</td>
          <td style="max-width:200px; overflow:hidden; text-overflow:ellipsis;">${m.content.substring(0, 50)}...</td>
          <td>
            <label class="toggle-switch">
              <input type="checkbox" ${m.active ? 'checked' : ''} onchange="toggleMacro('${m.id}', this.checked)" />
              <span class="toggle-slider"></span>
            </label>
          </td>
          <td>
            <button class="btn-sm" onclick="openModal('macro', ${JSON.stringify(m).replace(/"/g, '&quot;')})">âœï¸</button>
            <button class="btn-sm" onclick="deleteMacro('${m.id}')">ğŸ—‘ï¸</button>
          </td>
        </tr>
      `).join('');
    } catch (e) {
      console.error('Error loading macros:', e);
    }
  }

  // Init with all data
  if (checkAuth()) {
    loadDashboardStats();
    loadModulesOverview();
  }
</script>
