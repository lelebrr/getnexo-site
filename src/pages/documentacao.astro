---
import Layout from '../layouts/Layout.astro';

// Enhanced SEO Constants for Top Google Ranking
const pageTitle = "Documenta√ß√£o GetNexo: Guia de Infraestrutura e Configura√ß√£o | API Oficial";
const pageDescription = "Documenta√ß√£o t√©cnica completa GetNexo: instala√ß√£o Docker, configura√ß√£o Evolution API, IA, n8n workflows, Cloudflare Tunnel. Manual para deployment e manuten√ß√£o.";
const pageKeywords = "documentacao getnexo, instalacao docker, evolution api, n8n workflows, cloudflare tunnel, infraestrutura whatsapp, guia tecnico getnexo";

// Schema.org Technical Documentation
const schema = {
  "@context": "https://schema.org",
  "@type": "TechArticle",
  "headline": "Guia de Infraestrutura e Configura√ß√£o GetNexo",
  "description": "Explica√ß√£o t√©cnica detalhada sobre como montar e gerenciar a infraestrutura GetNexo.",
  "articleSection": "Technical Documentation",
  "author": {
    "@type": "Organization",
    "name": "GetNexo Technical Team"
  }
};
---

<Layout title={pageTitle} description={pageDescription} keywords={pageKeywords}>
  
  <!-- Auth Guard Script (Immediate Execution) -->
  <script is:inline>
    (function() {
      const token = localStorage.getItem('omnichat_token') || localStorage.getItem('adminToken');
      if (!token) {
        window.location.href = '/admin/login?redirect=' + encodeURIComponent(window.location.pathname);
      }
    })();
  </script>

  <div class="docs-wrapper">
    <!-- Sidebar Navigation -->
    <aside class="docs-sidebar">
      <div class="sidebar-header">
        <div class="brand-badge">SISTEMA MESTRE</div>
        <h3>Arquitetura</h3>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-group">
          <span class="group-label">Fundamentos</span>
          <a href="#arquitetura" class="nav-link active">üèóÔ∏è Vis√£o Geral</a>
          <a href="#requisitos" class="nav-link">üìã Requisitos</a>
        </div>
        <div class="nav-group">
          <span class="group-label">Implanta√ß√£o</span>
          <a href="#docker" class="nav-link">üê≥ Docker Compose</a>
          <a href="#env" class="nav-link">üîë Vari√°veis Env</a>
          <a href="#cloudflare" class="nav-link">üõ°Ô∏è T√∫neis & DNS</a>
        </div>
        <div class="nav-group">
          <span class="group-label">Componentes</span>
          <a href="#evolution" class="nav-link">üí¨ Evolution API</a>
          <a href="#brain" class="nav-link">üß† IA Brain Core</a>
          <a href="#n8n" class="nav-link">‚öôÔ∏è Workflows n8n</a>
        </div>
        <div class="nav-group">
          <span class="group-label">Manuten√ß√£o</span>
          <a href="#logs" class="nav-link">üìú Logs & Monitoria</a>
          <a href="#backup" class="nav-link">üíæ Backups</a>
        </div>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="docs-main">
      <header class="docs-page-header">
        <div class="breadcrumb">Documenta√ß√£o > Infraestrutura</div>
        <h1>Centro de Conhecimento <span class="text-gradient">GetNexo</span></h1>
        <p class="lead">Manual t√©cnico para o "GetNexo OS". Siga estas instru√ß√µes para garantir uma opera√ß√£o de alta disponibilidade e lat√™ncia zero.</p>
        
        <div class="status-indicator">
          <span class="pulse"></span> v4.2 stable ‚Ä¢ Homologado Meta API
        </div>
      </header>

      <div class="docs-grid">
        <!-- Quick Start Card -->
        <div class="docs-card highlight-card">
          <div class="card-icon">‚ö°</div>
          <div class="card-text">
            <h4>Quick Start</h4>
            <p>Git clone, Docker up e Cloudflare Tunnel. Em 12 minutos sua infraestrutura estar√° rodando.</p>
          </div>
          <a href="#docker" class="card-btn">Ver Guia</a>
        </div>

        <!-- Section: Arquitetura -->
        <section id="arquitetura" class="content-section">
          <h2>üèóÔ∏è Arquitetura do Sistema</h2>
          <p>O GetNexo n√£o √© apenas um script, √© um micro-ecossistema distribu√≠do via Docker. Ele se divide em 4 camadas principais:</p>
          
          <div class="architecture-grid">
            <div class="arch-item glass-panel">
              <span class="arch-label">Edge layer</span>
              <h4>Cloudflare Zero Trust</h4>
              <p>Prote√ß√£o contra DDoS, SSL Autom√°tico e t√∫neis seguros sem abrir portas no roteador.</p>
            </div>
            <div class="arch-item glass-panel">
              <span class="arch-label">Processing layer</span>
              <h4>Nginx & Backend Core</h4>
              <p>Roteamento de requisi√ß√µes, gest√£o de Webhooks e orquestra√ß√£o de mensagens.</p>
            </div>
            <div class="arch-item glass-panel">
              <span class="arch-label">Intelligence layer</span>
              <h4>OpenAI & Ollama</h4>
              <p>Processamento de linguagem natural (LLM) para automa√ß√£o de vendas e suporte.</p>
            </div>
            <div class="arch-item glass-panel">
              <span class="arch-label">Messaging layer</span>
              <h4>Evolution API</h4>
              <p>O cora√ß√£o do WhatsApp. Sincroniza√ß√£o multi-inst√¢ncia e estabilidade de conex√£o.</p>
            </div>
          </div>
        </section>

        <!-- Section: Docker -->
        <section id="docker" class="content-section">
          <h2>üê≥ Implanta√ß√£o Docker</h2>
          <p>Toda a infraestrutura √© controlada via <code>docker-compose.yml</code>. Certifique-se de ter o Docker v24+ instalado.</p>
          
          <div class="code-terminal">
            <div class="terminal-header">
              <div class="terminal-dots"><span></span><span></span><span></span></div>
              <span class="terminal-title">setup.sh</span>
            </div>
            <div class="terminal-body">
              <pre><code><span class="code-comment"># Clonar reposit√≥rio</span>
git clone https://github.com/lelebrr/usenexo.git
cd usenexo

<span class="code-comment"># Subir servi√ßos em background</span>
docker compose up -d

<span class="code-comment"># Verificar integridade dos containers</span>
docker ps --format "table &#123;&#123;.Names&#125;&#125;\t&#123;&#123;.Status&#125;&#125;\t&#123;&#123;.Ports&#125;&#125;"</code></pre>
            </div>
          </div>

          <div class="alert warn">
            <strong>CUIDADO:</strong> Nunca abra as portas 8080 ou 3000 diretamente no seu firewall. Utilize sempre o Cloudflare Tunnel para exposi√ß√£o segura.
          </div>
        </section>

        <!-- Section: Evolution API -->
        <section id="evolution" class="content-section">
          <h2>üí¨ Configurando Evolution API</h2>
          <p>A Evolution √© o que permite ao GetNexo falar com o WhatsApp. Ela roda na porta <code>3000</code> interna.</p>
          <ul class="styled-list">
            <li><strong>Manager URL:</strong> <code>https://evolution.seusite.com.br</code></li>
            <li><strong>Inst√¢ncia:</strong> Crie uma inst√¢ncia chamada 'GetNexoInstance'.</li>
            <li><strong>Webhooks:</strong> Aponte o webhook para <code>https://api.seusite.com.br/webhook</code></li>
            <li><strong>Eventos:</strong> Habilite 'MESSAGES_UPSERT' e 'PRESENCE_UPDATE'.</li>
          </ul>
        </section>

        <!-- Section: Logs -->
        <section id="logs" class="content-section">
          <h2>üìú Auditoria & Logs</h2>
          <p>Para depurar problemas de conex√£o ou de processamento de IA, utilize os logs em tempo real:</p>
          <div class="code-terminal">
            <div class="terminal-body">
              <pre><code><span class="code-comment"># Ver logs do Backend</span>
docker logs -f backend-getnexo --tail 100

<span class="code-comment"># Ver logs do WhatsApp (Evolution)</span>
docker logs -f evolution-api --tail 50</code></pre>
            </div>
          </div>
        </section>
      </div>

      <footer class="docs-footer">
        <div class="footer-cta glass-panel">
          <h3>Precisa de suporte extra?</h3>
          <p>Se voc√™ encontrou um bug cr√≠tico ou precisa de consultoria para deployment enterprise.</p>
          <div class="cta-row">
            <a href="https://wa.me/5511999999999" class="btn-whatsapp">Falar com DevOps</a>
            <a href="https://github.com/lelebrr" class="btn-github">GitHub Issues</a>
          </div>
        </div>
      </footer>
    </main>
  </div>

  <script type="application/ld+json" is:inline set:html={JSON.stringify(schema)}></script>

</Layout>

<style>
  /* Layout Base */
  .docs-wrapper {
    display: flex;
    min-height: 100vh;
    background: #030712;
    color: #e2e8f0;
  }

  /* Sidebar Styles */
  .docs-sidebar {
    width: 280px;
    background: rgba(10, 15, 26, 0.8);
    border-right: 1px solid rgba(255, 255, 255, 0.05);
    height: 100vh;
    position: sticky;
    top: 0;
    padding: 2rem 1.5rem;
    overflow-y: auto;
    backdrop-filter: blur(15px);
  }

  .brand-badge {
    background: linear-gradient(135deg, #00d4ff, #00ff9d);
    color: black;
    font-size: 0.65rem;
    font-weight: 900;
    padding: 0.25rem 0.6rem;
    border-radius: 4px;
    display: inline-block;
    letter-spacing: 1px;
    margin-bottom: 0.5rem;
  }

  .sidebar-header h3 {
    font-size: 1.25rem;
    font-weight: 800;
    color: white;
    margin-bottom: 2rem;
  }

  .nav-group {
    margin-bottom: 2rem;
  }

  .group-label {
    display: block;
    font-size: 0.7rem;
    font-weight: 900;
    color: #475569;
    text-transform: uppercase;
    letter-spacing: 2px;
    margin-bottom: 1rem;
  }

  .nav-link {
    display: block;
    padding: 0.6rem 1rem;
    color: #94a3b8;
    text-decoration: none;
    font-size: 0.9rem;
    font-weight: 600;
    border-radius: 8px;
    transition: 0.2s;
    margin-bottom: 0.25rem;
  }

  .nav-link:hover {
    color: white;
    background: rgba(255, 255, 255, 0.03);
  }

  .nav-link.active {
    color: #00ff9d;
    background: rgba(0, 255, 157, 0.05);
    border-left: 2px solid #00ff9d;
    border-radius: 0 8px 8px 0;
  }

  /* Main Content Styles */
  .docs-main {
    flex: 1;
    padding: 6rem 5% 4rem;
    max-width: 1000px;
    margin: 0 auto;
  }

  .docs-page-header {
    margin-bottom: 4rem;
  }

  .breadcrumb {
    font-size: 0.8rem;
    color: #64748b;
    margin-bottom: 1rem;
    font-weight: 700;
  }

  .docs-page-header h1 {
    font-size: 3.5rem;
    font-weight: 900;
    color: white;
    margin-bottom: 1.5rem;
    line-height: 1.1;
  }

  .lead {
    font-size: 1.25rem;
    color: #94a3b8;
    line-height: 1.6;
    margin-bottom: 2rem;
  }

  .status-indicator {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    background: rgba(15, 23, 42, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.05);
    padding: 0.5rem 1rem;
    border-radius: 50px;
    font-size: 0.85rem;
    font-weight: 700;
    color: #00ff9d;
  }

  .pulse {
    width: 8px;
    height: 8px;
    background: #00ff9d;
    border-radius: 50%;
    box-shadow: 0 0 10px #00ff9d;
    animation: docs-pulse 2s infinite;
  }

  @keyframes docs-pulse {
    0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(0, 255, 157, 0.7); }
    70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(0, 255, 157, 0); }
    100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(0, 255, 157, 0); }
  }

  /* Cards & Grid */
  .highlight-card {
    display: flex;
    align-items: center;
    gap: 2rem;
    background: linear-gradient(to right, rgba(0, 212, 255, 0.1), transparent);
    border: 1px solid rgba(0, 212, 255, 0.2);
    padding: 2.5rem;
    border-radius: 24px;
    margin-bottom: 4rem;
  }

  .card-icon {
    font-size: 3rem;
  }

  .card-text h4 {
    font-size: 1.5rem;
    font-weight: 800;
    color: white;
    margin-bottom: 0.5rem;
  }

  .card-btn {
    margin-left: auto;
    background: #00d4ff;
    color: black;
    padding: 0.8rem 1.5rem;
    border-radius: 12px;
    font-weight: 800;
    text-decoration: none;
    transition: 0.3s;
  }

  .card-btn:hover {
    transform: translateX(5px);
    box-shadow: 0 0 20px rgba(0, 212, 255, 0.4);
  }

  /* Content Sections */
  .content-section {
    margin-bottom: 6rem;
    scroll-margin-top: 100px;
  }

  .content-section h2 {
    font-size: 2.25rem;
    font-weight: 800;
    color: white;
    margin-bottom: 2rem;
  }

  .content-section p {
    font-size: 1.1rem;
    color: #94a3b8;
    line-height: 1.7;
    margin-bottom: 1.5rem;
  }

  .architecture-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1rem;
    margin-top: 2.5rem;
  }

  .arch-item {
    padding: 2rem;
    border-radius: 20px;
    background: rgba(15, 23, 42, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.03);
    transition: 0.3s;
  }

  .arch-item:hover {
    border-color: #00d4ff;
    transform: translateY(-5px);
  }

  .arch-label {
    font-size: 0.65rem;
    font-weight: 900;
    color: #00d4ff;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    display: block;
    margin-bottom: 1rem;
  }

  .arch-item h4 {
    color: white;
    font-weight: 700;
    margin-bottom: 0.75rem;
  }

  .arch-item p {
    font-size: 0.9rem;
    margin-bottom: 0;
  }

  /* Terminal UI */
  .code-terminal {
    background: #070b14;
    border: 1px solid #1e293b;
    border-radius: 16px;
    overflow: hidden;
    margin: 2rem 0;
  }

  .terminal-header {
    background: #111827;
    padding: 0.75rem 1.25rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #1e293b;
  }

  .terminal-dots {
    display: flex;
    gap: 0.5rem;
  }

  .terminal-dots span {
    width: 10px;
    height: 10px;
    border-radius: 50%;
  }

  .terminal-dots span:nth-child(1) { background: #ff5f56; }
  .terminal-dots span:nth-child(2) { background: #ffbd2e; }
  .terminal-dots span:nth-child(3) { background: #27c93f; }

  .terminal-title {
    font-size: 0.75rem;
    font-family: 'JetBrains Mono', monospace;
    color: #64748b;
  }

  .terminal-body {
    padding: 1.5rem;
    overflow-x: auto;
  }

  .terminal-body pre {
    margin: 0;
  }

  .terminal-body code {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.9rem;
    color: #e2e8f0;
    line-height: 1.6;
  }

  .code-comment {
    color: #64748b;
    font-style: italic;
  }

  /* Alerts */
  .alert {
    padding: 1.25rem 1.5rem;
    border-radius: 12px;
    font-size: 0.95rem;
    margin: 2rem 0;
  }

  .alert.warn {
    background: rgba(251, 191, 36, 0.05);
    border: 1px solid rgba(251, 191, 36, 0.2);
    color: #fbbf24;
  }

  /* Lists */
  .styled-list {
    list-style: none;
    padding: 0;
    margin: 2rem 0;
  }

  .styled-list li {
    padding: 1rem 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    color: #94a3b8;
  }

  .styled-list li strong {
    color: white;
    margin-right: 0.5rem;
  }

  /* Footer Section */
  .docs-footer {
    border-top: 1px solid rgba(255, 255, 255, 0.05);
    padding-top: 4rem;
    margin-top: 4rem;
  }

  .footer-cta {
    padding: 4rem;
    text-align: center;
    border-radius: 32px;
  }

  .footer-cta h3 {
    font-size: 2rem;
    font-weight: 800;
    color: white;
    margin-bottom: 1rem;
  }

  .cta-row {
    display: flex;
    justify-content: center;
    gap: 1.5rem;
    margin-top: 2.5rem;
  }

  .btn-whatsapp {
    background: #25D366;
    color: black;
    padding: 1rem 2rem;
    border-radius: 12px;
    font-weight: 800;
    text-decoration: none;
    transition: 0.3s;
  }

  .btn-github {
    background: rgba(255, 255, 255, 0.05);
    color: white;
    padding: 1rem 2rem;
    border-radius: 12px;
    font-weight: 700;
    text-decoration: none;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: 0.3s;
  }

  .btn-github:hover {
    background: rgba(255, 255, 255, 0.1);
  }

  @media (max-width: 1024px) {
    .docs-sidebar { display: none; }
    .docs-main { padding-top: 4rem; }
    .docs-page-header h1 { font-size: 2.5rem; }
    .cta-row { flex-direction: column; }
    .highlight-card { flex-direction: column; text-align: center; }
    .card-btn { margin: 0; width: 100%; }
  }
</style>
