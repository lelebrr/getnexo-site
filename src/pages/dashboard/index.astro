---
import DashboardLayout from '../../layouts/DashboardLayout.astro';
---

<DashboardLayout title="InÃ­cio | OmniNexo">
  <div style="display:flex; flex-direction:column; gap:2rem;">
    
    <!-- Welcome Header -->
    <div class="glass-panel" style="padding:2rem; background:linear-gradient(90deg, rgba(0,212,255,0.1), rgba(0,255,157,0.05)); border:1px solid rgba(0,212,255,0.15); display:flex; justify-content:space-between; align-items:center;">
        <div>
            <h2 style="font-size:2rem; font-weight:800; color:white; margin:0;">OlÃ¡, Admin! ðŸ‘‹</h2>
            <p style="color:#94a3b8; margin:0.5rem 0 0;">Seu OmniNexo estÃ¡ rodando perfeitamente. O que vamos fazer hoje?</p>
        </div>
        <a href="/dashboard/chat" style="background:#00d4ff; color:black; font-weight:bold; padding:10px 20px; border-radius:30px; text-decoration:none; box-shadow:0 0 15px rgba(0,212,255,0.4);">
            Abrir Inbox ðŸ’¬
        </a>
    </div>

    <!-- KPI Grid -->
    <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(250px, 1fr)); gap:1.5rem;">
        <div class="glass-panel" style="padding:1.5rem;">
            <div style="color:#64748b; font-size:0.9rem; font-weight:bold; text-transform:uppercase;">Vendas (Hoje)</div>
            <div id="stat-sales" style="font-size:2.5rem; font-weight:800; color:white; margin:0.5rem 0;">R$ 0,00</div>
            <div style="color:var(--neon-green); font-size:0.8rem;">---</div>
        </div>
        
        <div class="glass-panel" style="padding:1.5rem;">
            <div style="color:#64748b; font-size:0.9rem; font-weight:bold; text-transform:uppercase;">Tickets Abertos</div>
            <div id="stat-tickets" style="font-size:2.5rem; font-weight:800; color:white; margin:0.5rem 0;">0</div>
            <div style="color:var(--neon-blue); font-size:0.8rem;">Aguardando aÃ§Ã£o</div>
        </div>

        <div class="glass-panel" style="padding:1.5rem;">
            <div style="color:#64748b; font-size:0.9rem; font-weight:bold; text-transform:uppercase;">CSAT MÃ©dio</div>
            <div id="stat-csat" style="font-size:2.5rem; font-weight:800; color:white; margin:0.5rem 0;">-</div>
            <div style="color:#94a3b8; font-size:0.8rem;">Nota mÃ©dia</div>
        </div>
    </div>

    <script is:inline>
        // Fetch Real Dashboard Stats
        async function fetchStats() {
            try {
                // Use public URL if available, else localhost
                const API = 'http://localhost:3006'; 
                const res = await fetch(`${API}/dashboard-stats`);
                const data = await res.json();
                
                if (data) {
                    document.getElementById('stat-sales').innerText = 'R$ ' + (data.sales || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2});
                    document.getElementById('stat-tickets').innerText = data.open_tickets || 0;
                    document.getElementById('stat-csat').innerText = data.csat ? Number(data.csat).toFixed(1) : '-';
                }
            } catch (e) {
                console.error('Error fetching stats:', e);
            }
        }
        fetchStats();
        // Refresh every 30s
        setInterval(fetchStats, 30000);
    </script>

    <!-- Illustration / Empty State -->
    <div style="text-align:center; padding:3rem; opacity:0.5;">
        <svg width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="#334155" stroke-width="1" style="margin:0 auto 1rem;">
            <circle cx="12" cy="12" r="10"></circle>
            <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
            <path d="M2 12h20"></path>
        </svg>
        <p style="color:#64748b;">Sistema monitorando em tempo real. Tudo calmo por aqui.</p>
    </div>

  </div>
</DashboardLayout>
