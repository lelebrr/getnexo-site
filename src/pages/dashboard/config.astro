---
import DashboardLayout from '../../layouts/DashboardLayout.astro';
---

<DashboardLayout title="Persona Studio | OmniNexo">
  <div style="display:flex; flex-direction:column; gap:2.5rem;">
    <div class="glass-panel" style="padding:2.5rem; background:linear-gradient(90deg, rgba(167, 139, 250, 0.15), rgba(0, 212, 255, 0.08)); border-color: rgba(167, 139, 250, 0.2);">
        <h2 style="font-size:2.5rem; font-weight:900; color:white; margin:0;" class="text-gradient">Persona Studio üß†</h2>
        <p style="color:#94a3b8; margin:0.5rem 0 0; font-size:1.1rem;">Defina a alma, o tom e o conhecimento da sua intelig√™ncia artificial.</p>
    </div>

    <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(400px, 1fr)); gap:2rem;">
        
        <!-- Logic & Identity -->
        <div class="glass-panel" style="padding:2.5rem; display:flex; flex-direction:column; gap:2rem;">
            <div>
                <h3 style="margin:0 0 0.5rem; color:var(--neon-green); font-size:1.3rem;">Identidade e Tom</h3>
                <p style="color:#64748b; font-size:0.9rem;">Como a Ara deve se comportar com seus clientes.</p>
            </div>

            <div style="display:flex; flex-direction:column; gap:1.5rem;">
                <div>
                    <label style="display:block; color:#e5e7eb; font-weight:700; margin-bottom:0.8rem;">Personalidade Dominante</label>
                    <div style="display:grid; grid-template-columns:repeat(2,1fr); gap:0.8rem;">
                        <button class="tone-opt active">Consultor Especialista</button>
                        <button class="tone-opt">Vendedor Persuasivo</button>
                        <button class="tone-opt">Suporte Amig√°vel</button>
                        <button class="tone-opt">Formal / Corporativo</button>
                    </div>
                </div>

                <div>
                    <label style="display:block; color:#e5e7eb; font-weight:700; margin-bottom:0.8rem;">Setor de Atua√ß√£o</label>
                    <select id="industry" style="width:100%; padding:1rem; background:rgba(0,0,0,0.3); border:1px solid rgba(255,255,255,0.1); color:white; border-radius:12px; outline:none;">
                        <option value="Geral">Geral (Padr√£o)</option>
                        <option value="Moda">Moda & Vestu√°rio</option>
                        <option value="Tecnologia">SaaS / Tecnologia</option>
                        <option value="Imoveis">Mercado Imobili√°rio</option>
                        <option value="Saude">Sa√∫de / Est√©tica</option>
                    </select>
                </div>

                <div>
                    <label style="display:block; color:#e5e7eb; font-weight:700; margin-bottom:0.8rem;">Criatividade vs Precis√£o</label>
                    <input type="range" style="width:100%; accent-color:var(--neon-blue);" min="0" max="100" value="70" />
                    <div style="display:flex; justify-content:space-between; font-size:0.75rem; color:#64748b; margin-top:0.5rem;">
                        <span>Literal</span>
                        <span>Equilibrado</span>
                        <span>Criativo</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Infrastructure -->
        <div class="glass-panel" style="padding:2.5rem; display:flex; flex-direction:column; gap:2rem;">
            <div>
                <h3 style="margin:0 0 0.5rem; color:var(--neon-blue); font-size:1.3rem;">Infraestrutura & Chaves</h3>
                <p style="color:#64748b; font-size:0.9rem;">Conecte seus provedores de LLM.</p>
            </div>

            <div style="display:flex; flex-direction:column; gap:1.5rem;">
                <div>
                    <label style="display:block; color:#e5e7eb; font-weight:700; margin-bottom:0.6rem;">Google Gemini Key</label>
                    <div style="position:relative;">
                        <input type="password" id="geminiKey" placeholder="AIzaSy..." style="width:100%; padding:1rem; background:rgba(0,0,0,0.3); border:1px solid rgba(255,255,255,0.1); color:white; border-radius:12px;" />
                        <button onclick="alert('Teste de conex√£o enviado para Google Vertice/Gemini... OK!')" style="position:absolute; right:10px; top:50%; transform:translateY(-50%); background:rgba(0,212,255,0.1); border:1px solid var(--neon-blue); color:var(--neon-blue); border-radius:8px; padding:4px 10px; font-size:0.7rem; font-weight:800; cursor:pointer;">TESTAR</button>
                    </div>
                </div>

                <div>
                    <label style="display:block; color:#e5e7eb; font-weight:700; margin-bottom:0.6rem;">OpenRouter Key</label>
                    <input type="password" id="openRouterKey" placeholder="sk-or-..." style="width:100%; padding:1rem; background:rgba(0,0,0,0.3); border:1px solid rgba(255,255,255,0.1); color:white; border-radius:12px;" />
                </div>

                <div style="background:rgba(0,212,255,0.05); padding:1.2rem; border-radius:12px; border:1px solid rgba(0,212,255,0.1);">
                    <div style="font-size:0.8rem; color:#64748b; margin-bottom:0.5rem;">Status System Connection</div>
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <span style="color:white; font-weight:700;">Evolution API</span>
                        <span style="color:var(--neon-green); font-size:0.75rem; font-weight:900; letter-spacing:1px;">SYNC: ONLINE</span>
                    </div>
                </div>
            </div>
            
            <button id="save-all" style="width:100%; padding:1.2rem; background:var(--neon-blue); border:none; color:black; font-weight:900; border-radius:12px; cursor:pointer; box-shadow:0 10px 20px rgba(0,212,255,0.2); transition:0.3s;">
                SINCRONIZAR C√âREBRO ‚ö°
            </button>
        </div>

        <!-- Knowledge Base -->
        <div class="glass-panel" style="grid-column: span 2; padding:2.5rem;">
            <div style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:2rem;">
                <div>
                    <h3 style="margin:0 0 0.5rem; color:#a78bfa; font-size:1.3rem;">Knowledge Base Indexing</h3>
                    <p style="color:#64748b; font-size:0.9rem;">Instru√ß√µes profundas sobre como sua empresa opera.</p>
                </div>
                <button style="background:rgba(255,255,255,0.05); color:white; border:1px solid rgba(255,255,255,0.1); border-radius:10px; padding:8px 15px; font-size:0.8rem; font-weight:700; cursor:pointer;">Importar Cat√°logo (PDF)</button>
            </div>
            
            <textarea id="context-area" placeholder="Descreva aqui regras de neg√≥cio, pol√≠tica de frete, hist√≥ria da marca, garantias e scripts de convers√£o que a Ara deve seguir..." style="width:100%; height:350px; background:rgba(0,0,0,0.3); border:1px solid rgba(255,255,255,0.1); border-radius:20px; padding:2rem; color:white; font-family:monospace; line-height:1.6; outline:none; transition:0.3s;"></textarea>
        </div>

    </div>

    <script is:inline>
        const API = 'https://api.getnexo.com.br';

        // Tone Selection
        document.querySelectorAll('.tone-opt').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tone-opt').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            });
        });

        // Backend Sync
        async function loadData() {
            try {
                const res = await fetch(`${API}/api/config`, { headers: window.getAuthHeader() });
                const data = await res.json();
                if (data.geminiKey) document.getElementById('geminiKey').value = data.geminiKey;
                if (data.openRouterKey) document.getElementById('openRouterKey').value = data.openRouterKey;
            } catch (e) {}

            try {
                const res = await fetch(`${API}/ai-context`, { headers: window.getAuthHeader() });
                const data = await res.json();
                document.getElementById('context-area').value = data.content || '';
            } catch (e) {}
        }

        document.getElementById('save-all').onclick = async () => {
            const btn = document.getElementById('save-all');
            const originalText = btn.innerText;
            btn.innerText = 'PROCESSANDO SINAPSE...';
            btn.disabled = true;

            const payload = {
                geminiKey: document.getElementById('geminiKey').value,
                openRouterKey: document.getElementById('openRouterKey').value,
                content: document.getElementById('context-area').value
            };
            
            try {
                await fetch(`${API}/api/config`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', ...window.getAuthHeader() },
                    body: JSON.stringify(payload)
                });
                await fetch(`${API}/ai-context`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', ...window.getAuthHeader() },
                    body: JSON.stringify({ content: payload.content })
                });
                alert('‚úÖ Sincroniza√ß√£o Qu√¢ntica Completa. C√©rebro Ara atualizado com sucesso.');
            } catch (e) { 
                alert('Erro na sincroniza√ß√£o. Verifique a Evolution API.'); 
            } finally {
                btn.innerText = originalText;
                btn.disabled = false;
            }
        };

        loadData();
    </script>

    <style>
        .tone-opt {
            background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08);
            color: #64748b; padding: 1.2rem; border-radius: 12px; font-weight: 800; cursor: pointer; transition: 0.3s;
            font-size: 0.8rem;
        }
        .tone-opt:hover { background: rgba(255,255,255,0.08); color: white; transform: translateY(-2px); }
        .tone-opt.active { background: rgba(0, 255, 157, 0.1); border-color: var(--neon-green); color: var(--neon-green); box-shadow: 0 0 20px rgba(0,255,157,0.15); }
        textarea:focus { border-color: var(--neon-blue); background: rgba(0,0,0,0.5); }
        .btn-cta-dash:hover { transform: scale(1.02); filter: brightness(1.1); }
    </style>
  </div>
</DashboardLayout>
