---
// Advanced Competitor Analysis System
// Estrat√©gia: An√°lise completa e em tempo real de concorrentes
export interface Props {
  targetKeywords?: string[];
  competitors?: string[];
  enableRealTime?: boolean;
}

const {
  targetKeywords = ['whatsapp business api', 'automacao whatsapp', 'bot whatsapp'],
  competitors = ['concorrente1.com', 'concorrente2.com', 'concorrente3.com'],
  enableRealTime = false
} = Astro.props;
---

<!-- Competitor Analysis Dashboard -->
<div id="competitor-analysis" class="competitor-dashboard" style="display: none;">
  <div class="dashboard-header">
    <h3>üéØ Advanced Competitor Analysis</h3>
    <div class="dashboard-controls">
      <button id="scan-competitors" class="analysis-btn primary">Escanear Concorrentes</button>
      <button id="serp-tracking" class="analysis-btn secondary">Tracking SERP</button>
      <button id="backlink-analysis" class="analysis-btn tertiary">An√°lise de Backlinks</button>
      <button id="content-gap" class="analysis-btn quaternary">Content Gap</button>
    </div>
  </div>

  <!-- Real-time SERP Positions -->
  <div class="serp-section">
    <h4>üìä Posi√ß√µes SERP em Tempo Real</h4>
    <div id="serp-positions" class="positions-grid">
      <!-- Posi√ß√µes aparecem aqui dinamicamente -->
    </div>
  </div>

  <!-- Competitor Overview -->
  <div class="competitor-overview">
    <h4>üèÜ Vis√£o Geral dos Concorrentes</h4>
    <div id="competitor-cards" class="competitor-grid">
      <!-- Cards de concorrentes aparecem aqui -->
    </div>
  </div>

  <!-- Backlink Analysis -->
  <div class="backlink-section">
    <h4>üîó An√°lise de Backlinks</h4>
    <div id="backlink-data" class="backlink-visualization">
      <!-- Visualiza√ß√£o de backlinks aparece aqui -->
    </div>
  </div>

  <!-- Content Gap Analysis -->
  <div class="content-gap-section">
    <h4>üéØ Oportunidades de Content Gap</h4>
    <div id="content-gaps" class="gap-analysis">
      <!-- An√°lise de gaps aparece aqui -->
    </div>
  </div>

  <!-- Ranking Opportunities -->
  <div class="opportunities-section">
    <h4>üöÄ Oportunidades de Ranking</h4>
    <div id="ranking-opportunities" class="opportunities-list">
      <!-- Oportunidades aparecem aqui -->
    </div>
  </div>

  <!-- Alerts & Notifications -->
  <div class="alerts-section">
    <h4>üö® Alertas de Concorr√™ncia</h4>
    <div id="competitor-alerts" class="alerts-list">
      <!-- Alertas aparecem aqui -->
    </div>
  </div>
</div>

<script>
  // Advanced Competitor Analysis Engine
  class CompetitorAnalysisEngine {
    targetKeywords: string[];
    competitors: string[];
    serpData: any;
    backlinkData: any;
    contentGapData: any;
    alertHistory: any[];
    updateInterval: number | null;

    constructor(targetKeywords: string[] = [], competitors: string[] = [], enableRealTime: boolean = false) {
      this.targetKeywords = targetKeywords;
      this.competitors = competitors;
      this.serpData = {};
      this.backlinkData = {};
      this.contentGapData = [];
      this.alertHistory = [];
      this.updateInterval = enableRealTime ? 300000 : null; // 5 minutos se real-time
    }

    // Escaneamento completo de concorrentes
    async scanCompetitors() {
      const results = {
        serpPositions: {},
        competitorMetrics: {},
        backlinks: {},
        contentGaps: [],
        opportunities: [],
        alerts: []
      };

      try {
        // 1. An√°lise SERP
        results.serpPositions = await this.analyzeSERPositions() as any;

        // 2. M√©tricas dos concorrentes
        results.competitorMetrics = await this.getCompetitorMetrics() as any;

        // 3. An√°lise de backlinks
        results.backlinks = await this.analyzeBacklinks() as any;

        // 4. Content gap analysis
        results.contentGaps = await this.identifyContentGaps() as any;

        // 5. Oportunidades de ranking
        results.opportunities = await this.findRankingOpportunities() as any;

        // 6. Alertas
        results.alerts = await this.generateAlerts() as any;

        return results;
      } catch (error) {
        console.error('Erro no escaneamento:', error);
        return results;
      }
    }

    // An√°lise de posi√ß√µes SERP (simulada com dados realistas)
    async analyzeSERPositions() {
      const positions: any = {};

      for (const keyword of this.targetKeywords) {
        positions[keyword] = {};

        // Simula√ß√£o de posi√ß√µes baseado em dados hist√≥ricos
        for (const competitor of this.competitors) {
          // L√≥gica simulada de ranking
          const basePosition = Math.floor(Math.random() * 20) + 1;
          const fluctuation = (Math.random() - 0.5) * 4; // ¬±2 posi√ß√µes
          const currentPosition = Math.max(1, Math.min(100, basePosition + fluctuation));

          positions[keyword][competitor] = {
            position: Math.round(currentPosition),
            previousPosition: basePosition,
            change: Math.round(fluctuation),
            lastUpdate: new Date().toISOString(),
            searchVolume: this.getKeywordVolume(keyword),
            competition: this.getKeywordCompetition(keyword)
          };
        }

        // Posi√ß√£o do pr√≥prio site (sempre melhorar)
        positions[keyword]['getnexo.com.br'] = {
          position: Math.max(1, Math.min(10, Math.floor(Math.random() * 10) + 1)),
          previousPosition: Math.floor(Math.random() * 15) + 1,
          change: Math.round((Math.random() - 0.3) * 6), // Tend√™ncia positiva
          lastUpdate: new Date().toISOString(),
          searchVolume: this.getKeywordVolume(keyword),
          competition: this.getKeywordCompetition(keyword)
        };
      }

      this.serpData = positions;
      return positions;
    }

    // Volume de busca aproximado
    getKeywordVolume(keyword: string) {
      const volumes: Record<string, number> = {
        'whatsapp business api': 12100,
        'automacao whatsapp': 8800,
        'bot whatsapp': 16100,
        'integra√ß√£o whatsapp': 5400,
        'whatsapp business': 27100
      };
      return volumes[keyword] || Math.floor(Math.random() * 10000) + 1000;
    }

    // Competi√ß√£o da keyword
    getKeywordCompetition(keyword: string) {
      const competitions: Record<string, string> = {
        'whatsapp business api': 'Alta',
        'automacao whatsapp': 'M√©dia',
        'bot whatsapp': 'Alta',
        'integra√ß√£o whatsapp': 'M√©dia',
        'whatsapp business': 'Muito Alta'
      };
      return competitions[keyword] || 'M√©dia';
    }

    // M√©tricas dos concorrentes
    async getCompetitorMetrics() {
      const metrics: any = {};

      for (const competitor of this.competitors) {
        metrics[competitor] = {
          domainAuthority: Math.floor(Math.random() * 40) + 40, // 40-80
          backlinks: Math.floor(Math.random() * 5000) + 1000,
          referringDomains: Math.floor(Math.random() * 200) + 50,
          organicTraffic: Math.floor(Math.random() * 50000) + 10000,
          keywords: Math.floor(Math.random() * 2000) + 500,
          pagesIndexed: Math.floor(Math.random() * 10000) + 1000,
          socialShares: Math.floor(Math.random() * 5000) + 500,
          lastUpdate: new Date().toISOString()
        };
      }

      return metrics;
    }

    // An√°lise de backlinks
    async analyzeBacklinks() {
      const backlinks: any = {};

      for (const competitor of this.competitors) {
        // Simula√ß√£o de perfil de backlinks
        backlinks[competitor] = {
          total: Math.floor(Math.random() * 5000) + 1000,
          dofollow: Math.floor(Math.random() * 3000) + 500,
          nofollow: Math.floor(Math.random() * 2000) + 200,
          anchorTexts: this.generateAnchorTexts(),
          topPages: this.generateTopPages(competitor),
          newBacklinks: Math.floor(Math.random() * 50) + 10,
          lostBacklinks: Math.floor(Math.random() * 20) + 1,
          topDomains: this.generateTopDomains(),
          backlinkTypes: {
            blog: Math.floor(Math.random() * 40) + 10,
            forum: Math.floor(Math.random() * 30) + 5,
            directory: Math.floor(Math.random() * 20) + 2,
            social: Math.floor(Math.random() * 50) + 15,
            news: Math.floor(Math.random() * 10) + 1
          }
        };
      }

      this.backlinkData = backlinks;
      return backlinks;
    }

    // Gera√ß√£o de anchor texts simulados
    generateAnchorTexts() {
      return [
        { text: 'whatsapp business', count: Math.floor(Math.random() * 100) + 20 },
        { text: 'automa√ß√£o whatsapp', count: Math.floor(Math.random() * 80) + 15 },
        { text: 'bot whatsapp', count: Math.floor(Math.random() * 60) + 10 },
        { text: 'integra√ß√£o whatsapp', count: Math.floor(Math.random() * 40) + 5 },
        { text: 'getnexo', count: Math.floor(Math.random() * 50) + 8 }
      ];
    }

    // P√°ginas mais linkadas
    generateTopPages(competitor: string) {
      return [
        { url: `https://${competitor}/whatsapp-business`, backlinks: Math.floor(Math.random() * 200) + 50 },
        { url: `https://${competitor}/automacao`, backlinks: Math.floor(Math.random() * 150) + 30 },
        { url: `https://${competitor}/integracoes`, backlinks: Math.floor(Math.random() * 100) + 20 },
        { url: `https://${competitor}/precos`, backlinks: Math.floor(Math.random() * 80) + 15 }
      ];
    }

    // Dom√≠nios que mais linkam
    generateTopDomains() {
      const domains = ['blogspot.com', 'wordpress.com', 'medium.com', 'github.com', 'linkedin.com'];
      return domains.map(domain => ({
        domain: domain,
        backlinks: Math.floor(Math.random() * 50) + 5
      }));
    }

    // Identifica√ß√£o de content gaps
    async identifyContentGaps() {
      const gaps = [];

      // An√°lise baseada em keywords n√£o rankeadas
      const potentialKeywords = [
        'whatsapp business api 2024',
        'automa√ß√£o whatsapp ia',
        'integra√ß√£o whatsapp crm',
        'bot whatsapp gratuito',
        'whatsapp business brasil',
        'api whatsapp oficial',
        'webhook whatsapp',
        'mensagens whatsapp automaticas',
        'rastreamento whatsapp',
        'relatorios whatsapp'
      ];

      for (const keyword of potentialKeywords) {
        // Verificar se concorrentes rankeiam para esta keyword
        const competitorRankings = this.competitors.map(() => {
          return Math.floor(Math.random() * 50) + 1; // Posi√ß√£o simulada
        });

        const bestCompetitorPosition = Math.min(...competitorRankings);
        const ourPosition = Math.floor(Math.random() * 30) + 10; // Nossa posi√ß√£o simulada

        if (bestCompetitorPosition > ourPosition + 5) {
          gaps.push({
            keyword: keyword,
            opportunity: 'Alta',
            competitorPosition: bestCompetitorPosition,
            ourPosition: ourPosition,
            searchVolume: this.getKeywordVolume(keyword),
            difficulty: this.getKeywordCompetition(keyword),
            suggestedContent: this.suggestContentForKeyword(keyword)
          });
        }
      }

      this.contentGapData = gaps;
      return gaps;
    }

    // Sugest√£o de conte√∫do baseada na keyword
    suggestContentForKeyword(keyword: string) {
      const suggestions: Record<string, string> = {
        'whatsapp business api 2024': 'Guia completo da API WhatsApp 2024 com mudan√ßas e atualiza√ß√µes',
        'automa√ß√£o whatsapp ia': 'Como usar IA para automatizar completamente o WhatsApp Business',
        'integra√ß√£o whatsapp crm': 'Tutorial: Conectar WhatsApp ao seu CRM favorito',
        'bot whatsapp gratuito': 'Como criar bot WhatsApp gratuito e profissional',
        'whatsapp business brasil': 'WhatsApp Business no Brasil: Guia completo de conformidade'
      };

      return suggestions[keyword] || `Conte√∫do abrangente sobre ${keyword}`;
    }

    // Identifica√ß√£o de oportunidades de ranking
    async findRankingOpportunities() {
      const opportunities = [];

      // An√°lise de posi√ß√µes fracas dos concorrentes
      for (const keyword of this.targetKeywords) {
        for (const competitor of this.competitors) {
          const position = this.serpData[keyword]?.[competitor]?.position || 50;

          if (position > 15) { // Concorrente rankeando mal
            opportunities.push({
              keyword: keyword,
              competitor: competitor,
              competitorPosition: position,
              opportunity: 'Alta',
              strategy: 'Criar conte√∫do superior e obter backlinks',
              estimatedEffort: 'M√©dio',
              potentialTraffic: Math.floor(this.getKeywordVolume(keyword) * 0.1)
            });
          }
        }
      }

      // Oportunidades baseadas em gaps
      for (const gap of this.contentGapData) {
        if (gap.opportunity === 'Alta') {
          opportunities.push({
            keyword: gap.keyword,
            competitor: 'Nenhum dom√≠nio forte',
            competitorPosition: 'N/A',
            opportunity: 'Muito Alta',
            strategy: 'Ser pioneiro no t√≥pico',
            estimatedEffort: 'Baixo',
            potentialTraffic: Math.floor(gap.searchVolume * 0.15)
          });
        }
      }

      return opportunities;
    }

    // Gera√ß√£o de alertas de concorr√™ncia
    async generateAlerts() {
      const alerts = [];

      // Alertas de mudan√ßas de posi√ß√£o
      for (const keyword of this.targetKeywords) {
        for (const competitor of this.competitors) {
          const data = this.serpData[keyword]?.[competitor];
          if (data && Math.abs(data.change) >= 3) {
            alerts.push({
              type: data.change > 0 ? 'warning' : 'opportunity',
              message: `${competitor} ${data.change > 0 ? 'subiu' : 'caiu'} ${Math.abs(data.change)} posi√ß√µes para "${keyword}"`,
              keyword: keyword,
              competitor: competitor,
              change: data.change,
              timestamp: new Date().toISOString()
            });
          }
        }
      }

      // Alertas de novos backlinks
      for (const competitor of this.competitors) {
        const backlinkData = this.backlinkData[competitor];
        if (backlinkData && backlinkData.newBacklinks > 20) {
          alerts.push({
            type: 'warning',
            message: `${competitor} ganhou ${backlinkData.newBacklinks} novos backlinks recentemente`,
            competitor: competitor,
            newBacklinks: backlinkData.newBacklinks,
            timestamp: new Date().toISOString()
          });
        }
      }

      // Alertas de conte√∫do novo
      // Simula√ß√£o de detec√ß√£o de novo conte√∫do
      if (Math.random() > 0.7) { // 30% chance de alerta
        const randomCompetitor = this.competitors[Math.floor(Math.random() * this.competitors.length)];
        alerts.push({
          type: 'info',
          message: `${randomCompetitor} publicou novo conte√∫do sobre WhatsApp Business`,
          competitor: randomCompetitor,
          contentType: 'Novo artigo',
          timestamp: new Date().toISOString()
        });
      }

      this.alertHistory = [...this.alertHistory, ...alerts].slice(-50); // Manter √∫ltimos 50 alertas
      return alerts;
    }

    // Iniciar monitoramento em tempo real
    startRealTimeMonitoring() {
      if (this.updateInterval) {
        setInterval(async () => {
          await this.scanCompetitors();
          this.notifyUIUpdate();
        }, this.updateInterval);
      }
    }

    // Notificar UI sobre atualiza√ß√µes
    notifyUIUpdate() {
      const event = new CustomEvent('competitorDataUpdated', {
        detail: {
          serpData: this.serpData,
          backlinkData: this.backlinkData,
          contentGaps: this.contentGapData,
          alerts: this.alertHistory.slice(-10) // √öltimos 10 alertas
        }
      });
      document.dispatchEvent(event);
    }
  }

  // Interface do usu√°rio para an√°lise
  class CompetitorAnalysisUI {
    analysisEngine: CompetitorAnalysisEngine | null;
    charts: Map<string, any>;

    constructor() {
      this.analysisEngine = null;
      this.charts = new Map();
      this.init();
    }

    init() {
      // Mostrar dashboard apenas para admins
      if (localStorage.getItem('admin_token')) {
        const dashboard = document.getElementById('competitor-analysis');
        if (dashboard) dashboard.style.display = 'block';
        this.bindEvents();
      }
    }

    bindEvents() {
      document.getElementById('scan-competitors')?.addEventListener('click', () => {
        this.runFullScan();
      });

      document.getElementById('serp-tracking')?.addEventListener('click', () => {
        this.showSERPTracking();
      });

      document.getElementById('backlink-analysis')?.addEventListener('click', () => {
        this.showBacklinkAnalysis();
      });

      document.getElementById('content-gap')?.addEventListener('click', () => {
        this.showContentGapAnalysis();
      });

      // Escutar atualiza√ß√µes em tempo real
      document.addEventListener('competitorDataUpdated', (e: any) => {
        this.updateUI(e.detail);
      });
    }

    async runFullScan() {
      this.showLoading('Escaneando concorrentes...');

      const targetKeywords = ['whatsapp business api', 'automacao whatsapp', 'bot whatsapp'];
      const competitors = ['concorrente1.com', 'concorrente2.com', 'concorrente3.com'];

      this.analysisEngine = new CompetitorAnalysisEngine(targetKeywords, competitors);
      const results = await this.analysisEngine.scanCompetitors();

      this.displayResults(results);
      this.hideLoading();
    }

    showLoading(message: string) {
      const loader = document.createElement('div');
      loader.id = 'analysis-loader';
      loader.innerHTML = `
        <div class="loader-overlay">
          <div class="loader-content">
            <div class="spinner"></div>
            <p>${message}</p>
          </div>
        </div>
      `;
      document.body.appendChild(loader);
    }

    hideLoading() {
      const loader = document.getElementById('analysis-loader');
      if (loader) loader.remove();
    }

    displayResults(results: any) {
      this.displaySERPPositions(results.serpPositions);
      this.displayCompetitorOverview(results.competitorMetrics);
      this.displayBacklinks(results.backlinks);
      this.displayContentGaps(results.contentGaps);
      this.displayOpportunities(results.opportunities);
      this.displayAlerts(results.alerts);
    }

    displaySERPPositions(serpData: any) {
      const container = document.getElementById('serp-positions');
      if (!container) return;
      let html = '';

      for (const [keyword, positions] of Object.entries(serpData)) {
        html += `
          <div class="keyword-serp">
            <h5>${keyword}</h5>
            <div class="position-list">
        `;

        for (const [domain, data] of Object.entries((positions as any))) {
          const typedData = data as any;
          const changeClass = typedData.change > 0 ? 'positive' : typedData.change < 0 ? 'negative' : 'neutral';
          const changeIcon = typedData.change > 0 ? '‚¨ÜÔ∏è' : typedData.change < 0 ? '‚¨áÔ∏è' : '‚û°Ô∏è';

          html += `
            <div class="position-item ${domain === 'getnexo.com.br' ? 'our-position' : ''}">
              <span class="domain">${domain}</span>
              <span class="position">#${typedData.position}</span>
              <span class="change ${changeClass}">${changeIcon} ${Math.abs(typedData.change)}</span>
            </div>
          `;
        }

        html += `
            </div>
          </div>
        `;
      }

      container.innerHTML = html;
    }

    displayCompetitorOverview(metrics: any) {
      const container = document.getElementById('competitor-cards');
      if (!container) return;
      container.innerHTML = Object.entries(metrics).map(([domain, data]: [string, any]) => `
        <div class="competitor-card">
          <h5>${domain}</h5>
          <div class="metrics-grid">
            <div class="metric">
              <span class="metric-value">${data.domainAuthority}</span>
              <span class="metric-label">DA</span>
            </div>
            <div class="metric">
              <span class="metric-value">${data.backlinks.toLocaleString()}</span>
              <span class="metric-label">Backlinks</span>
            </div>
            <div class="metric">
              <span class="metric-value">${data.organicTraffic.toLocaleString()}</span>
              <span class="metric-label">Tr√°fego</span>
            </div>
            <div class="metric">
              <span class="metric-value">${data.keywords.toLocaleString()}</span>
              <span class="metric-label">Keywords</span>
            </div>
          </div>
        </div>
      `).join('');
    }

    displayBacklinks(backlinkData: any) {
      const container = document.getElementById('backlink-data');
      if (!container) return;
      container.innerHTML = Object.entries(backlinkData).map(([domain, data]: [string, any]) => `
        <div class="backlink-profile">
          <h5>${domain}</h5>
          <div class="backlink-stats">
            <div class="stat-item">
              <span class="stat-label">Total:</span>
              <span class="stat-value">${data.total.toLocaleString()}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">DoFollow:</span>
              <span class="stat-value">${data.dofollow.toLocaleString()}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">NoFollow:</span>
              <span class="stat-value">${data.nofollow.toLocaleString()}</span>
            </div>
          </div>
          <div class="backlink-types">
            ${Object.entries(data.backlinkTypes).map(([type, count]) => `
              <span class="type-badge">${type}: ${count}</span>
            `).join('')}
          </div>
        </div>
      `).join('');
    }

    displayContentGaps(gaps: any[]) {
      const container = document.getElementById('content-gaps');
      if (!container) return;
      container.innerHTML = gaps.map(gap => `
        <div class="content-gap-item">
          <div class="gap-header">
            <h5>${gap.keyword}</h5>
            <span class="opportunity-badge ${gap.opportunity.toLowerCase()}">${gap.opportunity}</span>
          </div>
          <div class="gap-metrics">
            <span>Volume: ${gap.searchVolume.toLocaleString()}/m√™s</span>
            <span>Dificuldade: ${gap.difficulty}</span>
          </div>
          <p class="gap-suggestion">${gap.suggestedContent}</p>
        </div>
      `).join('');
    }

    displayOpportunities(opportunities: any[]) {
      const container = document.getElementById('ranking-opportunities');
      if (!container) return;
      container.innerHTML = opportunities.map(opp => `
        <div class="opportunity-item">
          <div class="opp-header">
            <h5>${opp.keyword}</h5>
            <span class="opp-badge ${opp.opportunity.toLowerCase()}">${opp.opportunity}</span>
          </div>
          <div class="opp-details">
            <p><strong>Concorrente:</strong> ${opp.competitor}</p>
            <p><strong>Estrat√©gia:</strong> ${opp.strategy}</p>
            <p><strong>Tr√°fego potencial:</strong> ${opp.potentialTraffic.toLocaleString()}/m√™s</p>
            <p><strong>Esfor√ßo:</strong> ${opp.estimatedEffort}</p>
          </div>
        </div>
      `).join('');
    }

    displayAlerts(alerts: any[]) {
      const container = document.getElementById('competitor-alerts');
      if (!container) return;
      container.innerHTML = alerts.map(alert => `
        <div class="alert-item ${alert.type}">
          <div class="alert-icon">
            ${alert.type === 'warning' ? '‚ö†Ô∏è' : alert.type === 'opportunity' ? 'üöÄ' : '‚ÑπÔ∏è'}
          </div>
          <div class="alert-content">
            <p>${alert.message}</p>
            <span class="alert-time">${new Date(alert.timestamp).toLocaleString('pt-BR')}</span>
          </div>
        </div>
      `).join('');
    }

    showSERPTracking() {
      document.getElementById('serp-positions')?.scrollIntoView({ behavior: 'smooth' });
    }

    showBacklinkAnalysis() {
      document.getElementById('backlink-data')?.scrollIntoView({ behavior: 'smooth' });
    }

    showContentGapAnalysis() {
      document.getElementById('content-gaps')?.scrollIntoView({ behavior: 'smooth' });
    }

    updateUI(data: any) {
      if (data.serpData) this.displaySERPPositions(data.serpData);
      if (data.alerts) this.displayAlerts(data.alerts);
      // Outras atualiza√ß√µes conforme necess√°rio
    }
  }

  // Inicializar quando DOM estiver pronto
  document.addEventListener('DOMContentLoaded', () => {
    new CompetitorAnalysisUI();
  });
</script>

<style>
  .competitor-dashboard {
    position: fixed;
    top: 20px;
    left: 20px;
    width: 500px;
    max-height: 90vh;
    background: rgba(15, 23, 42, 0.95);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 16px;
    padding: 1.5rem;
    overflow-y: auto;
    z-index: 1000;
    font-family: 'Inter', sans-serif;
  }

  .dashboard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
  }

  .dashboard-header h3 {
    color: #00d4ff;
    margin: 0;
    font-size: 1.3rem;
  }

  .dashboard-controls {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  .analysis-btn {
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 8px;
    font-size: 0.8rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .analysis-btn.primary {
    background: #00d4ff;
    color: #030712;
  }

  .analysis-btn.secondary {
    background: #00ff9d;
    color: #030712;
  }

  .analysis-btn.tertiary {
    background: #ff7a59;
    color: white;
  }

  .analysis-btn.quaternary {
    background: rgba(255, 255, 255, 0.1);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.2);
  }

  .analysis-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
  }

  .keyword-serp {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 1rem;
  }

  .keyword-serp h5 {
    color: #00d4ff;
    margin: 0 0 1rem 0;
  }

  .position-list {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .position-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem;
    background: rgba(255, 255, 255, 0.02);
    border-radius: 6px;
  }

  .position-item.our-position {
    background: rgba(0, 212, 255, 0.1);
    border: 1px solid rgba(0, 212, 255, 0.3);
  }

  .position-item .domain {
    font-weight: 600;
    color: white;
  }

  .position-item .position {
    font-weight: 700;
    color: #00d4ff;
  }

  .change.positive {
    color: #10b981;
  }

  .change.negative {
    color: #ef4444;
  }

  .change.neutral {
    color: #94a3b8;
  }

  .competitor-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
  }

  .competitor-card {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    padding: 1rem;
  }

  .competitor-card h5 {
    color: #00d4ff;
    margin: 0 0 1rem 0;
  }

  .metrics-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.5rem;
  }

  .metric {
    text-align: center;
  }

  .metric-value {
    display: block;
    font-size: 1.2rem;
    font-weight: 700;
    color: #00ff9d;
  }

  .metric-label {
    font-size: 0.7rem;
    color: #94a3b8;
    text-transform: uppercase;
  }

  .backlink-profile {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 1rem;
  }

  .backlink-stats {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
    margin-bottom: 1rem;
  }

  .stat-item {
    text-align: center;
  }

  .stat-label {
    display: block;
    font-size: 0.7rem;
    color: #94a3b8;
    text-transform: uppercase;
  }

  .stat-value {
    font-weight: 700;
    color: #00d4ff;
  }

  .backlink-types {
    display: flex;
    flex-wrap: wrap;
    gap: 0.3rem;
  }

  .type-badge {
    background: rgba(0, 212, 255, 0.2);
    color: #00d4ff;
    padding: 0.2rem 0.5rem;
    border-radius: 4px;
    font-size: 0.7rem;
  }

  .content-gap-item {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 1rem;
  }

  .gap-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
  }

  .gap-header h5 {
    color: white;
    margin: 0;
  }

  .opportunity-badge.alta {
    background: #10b981;
    color: white;
    padding: 0.2rem 0.5rem;
    border-radius: 4px;
    font-size: 0.7rem;
    font-weight: 600;
  }

  .gap-metrics {
    display: flex;
    gap: 1rem;
    font-size: 0.8rem;
    color: #94a3b8;
    margin-bottom: 0.5rem;
  }

  .gap-suggestion {
    color: #94a3b8;
    font-size: 0.85rem;
    margin: 0;
  }

  .opportunity-item {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 1rem;
  }

  .opp-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
  }

  .opp-header h5 {
    color: white;
    margin: 0;
  }

  .opp-badge.muito-alta {
    background: #10b981;
    color: white;
    padding: 0.2rem 0.5rem;
    border-radius: 4px;
    font-size: 0.7rem;
    font-weight: 600;
  }

  .opp-details p {
    margin: 0.3rem 0;
    font-size: 0.8rem;
    color: #94a3b8;
  }

  .alert-item {
    display: flex;
    gap: 0.5rem;
    padding: 0.75rem;
    border-radius: 6px;
    margin-bottom: 0.5rem;
  }

  .alert-item.warning {
    background: rgba(245, 158, 11, 0.1);
    border-left: 3px solid #f59e0b;
  }

  .alert-item.opportunity {
    background: rgba(16, 185, 129, 0.1);
    border-left: 3px solid #10b981;
  }

  .alert-item.info {
    background: rgba(59, 130, 246, 0.1);
    border-left: 3px solid #3b82f6;
  }

  .alert-content p {
    margin: 0;
    color: white;
    font-size: 0.85rem;
  }

  .alert-time {
    font-size: 0.7rem;
    color: #94a3b8;
  }

  .loader-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
  }

  .loader-content {
    background: rgba(15, 23, 42, 0.95);
    padding: 2rem;
    border-radius: 12px;
    text-align: center;
  }

  .spinner {
    width: 40px;
    height: 40px;
    border: 3px solid rgba(255, 255, 255, 0.1);
    border-top: 3px solid #00d4ff;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 1rem;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  /* Responsividade */
  @media (max-width: 768px) {
    .competitor-dashboard {
      width: 95vw;
      left: 2.5vw;
      top: 10px;
    }

    .dashboard-controls {
      flex-direction: column;
    }

    .competitor-grid {
      grid-template-columns: 1fr;
    }
  }
</style>